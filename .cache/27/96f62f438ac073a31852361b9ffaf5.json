{"id":"rdGo","dependencies":[{"name":"/Users/polluterofminds/Development/simpleid/ssa-sdk/package.json","includedInParent":true,"mtime":1584306008866},{"name":"/Users/polluterofminds/Development/simpleid/ssa-sdk/node_modules/orbit-db-pubsub/package.json","includedInParent":true,"mtime":1582579779286},{"name":"p-series","loc":{"line":3,"column":24},"parent":"/Users/polluterofminds/Development/simpleid/ssa-sdk/node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","resolved":"/Users/polluterofminds/Development/simpleid/ssa-sdk/node_modules/p-series/index.js"},{"name":"ipfs-pubsub-peer-monitor","loc":{"line":4,"column":28},"parent":"/Users/polluterofminds/Development/simpleid/ssa-sdk/node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","resolved":"/Users/polluterofminds/Development/simpleid/ssa-sdk/node_modules/ipfs-pubsub-peer-monitor/src/ipfs-pubsub-peer-monitor.js"},{"name":"logplease","loc":{"line":6,"column":23},"parent":"/Users/polluterofminds/Development/simpleid/ssa-sdk/node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","resolved":"/Users/polluterofminds/Development/simpleid/ssa-sdk/node_modules/logplease/src/index.js"},{"name":"buffer","parent":"/Users/polluterofminds/Development/simpleid/ssa-sdk/node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","resolved":"/Users/polluterofminds/Development/simpleid/ssa-sdk/node_modules/node-libs-browser/node_modules/buffer/index.js"}],"generated":{"js":"var Buffer = require(\"buffer\").Buffer;\nvar s=require(\"buffer\").Buffer;const e=require(\"p-series\"),i=require(\"ipfs-pubsub-peer-monitor\"),t=require(\"logplease\"),r=t.create(\"pubsub\",{color:t.Colors.Yellow});t.setLogLevel(\"ERROR\");const o=256;let n=0;class u{constructor(s,e){this._ipfs=s,this._id=e,this._subscriptions={},null===this._ipfs.pubsub&&r.error(\"The provided version of ipfs doesn't have pubsub support. Messages will not be exchanged.\"),this._handleMessage=this._handleMessage.bind(this),this._ipfs.setMaxListeners&&this._ipfs.setMaxListeners(o)}async subscribe(s,e,t){if(!this._subscriptions[s]&&this._ipfs.pubsub){await this._ipfs.pubsub.subscribe(s,this._handleMessage);const o=new i(this._ipfs.pubsub,s);o.on(\"join\",e=>{r.debug(`Peer joined ${s}:`),r.debug(e),this._subscriptions[s]?t(s,e):(r.warn(\"Peer joined a room we don't have a subscription for\"),r.warn(s,e))}),o.on(\"leave\",e=>r.debug(`Peer ${e} left ${s}`)),o.on(\"error\",s=>r.error(s)),this._subscriptions[s]={topicMonitor:o,onMessage:e,onNewPeer:t},n++,r.debug(\"Topics open:\",n)}}async unsubscribe(s){this._subscriptions[s]&&(await this._ipfs.pubsub.unsubscribe(s,this._handleMessage),this._subscriptions[s].topicMonitor.stop(),delete this._subscriptions[s],r.debug(`Unsubscribed from '${s}'`),n--,r.debug(\"Topics open:\",n))}publish(e,i){this._subscriptions[e]&&this._ipfs.pubsub&&this._ipfs.pubsub.publish(e,s.from(JSON.stringify(i)))}async disconnect(){const s=Object.keys(this._subscriptions);await e(s.map(s=>this.unsubscribe.bind(this,s))),this._subscriptions={}}async _handleMessage(s){if(s.from===this._id)return;let e,i,t;try{t=s.topicIDs[0],e=JSON.parse(s.data),i=this._subscriptions[t]}catch(o){r.error(o),r.error(\"Couldn't parse pubsub message:\",s)}i&&i.onMessage&&e&&await i.onMessage(t,e,s.from)}}module.exports=u;"},"sourceMaps":{"js":{"mappings":[{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":108,"column":0},"generated":{"line":2,"column":0}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":108,"column":0},"generated":{"line":2,"column":4}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":108,"column":0},"generated":{"line":2,"column":6}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":108,"column":0},"generated":{"line":2,"column":14}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":108,"column":0},"generated":{"line":2,"column":24}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":3,"column":0},"generated":{"line":2,"column":31}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":3,"column":0},"generated":{"line":2,"column":37}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":3,"column":0},"generated":{"line":2,"column":39}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":3,"column":0},"generated":{"line":2,"column":47}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":4,"column":0},"generated":{"line":2,"column":59}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":4,"column":0},"generated":{"line":2,"column":61}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":4,"column":0},"generated":{"line":2,"column":69}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":6,"column":0},"generated":{"line":2,"column":97}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":6,"column":0},"generated":{"line":2,"column":99}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":6,"column":0},"generated":{"line":2,"column":107}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":7,"column":0},"generated":{"line":2,"column":120}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":7,"column":0},"generated":{"line":2,"column":122}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":7,"column":0},"generated":{"line":2,"column":124}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":7,"column":0},"generated":{"line":2,"column":131}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":7,"column":0},"generated":{"line":2,"column":140}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":7,"column":0},"generated":{"line":2,"column":141}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":7,"column":0},"generated":{"line":2,"column":147}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":7,"column":0},"generated":{"line":2,"column":149}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":7,"column":0},"generated":{"line":2,"column":156}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":8,"column":0},"generated":{"line":2,"column":165}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":8,"column":0},"generated":{"line":2,"column":167}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":8,"column":0},"generated":{"line":2,"column":179}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":10,"column":0},"generated":{"line":2,"column":188}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":10,"column":0},"generated":{"line":2,"column":194}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":10,"column":0},"generated":{"line":2,"column":196}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":11,"column":0},"generated":{"line":2,"column":200}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":11,"column":0},"generated":{"line":2,"column":204}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":11,"column":0},"generated":{"line":2,"column":206}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":13,"column":0},"generated":{"line":2,"column":208}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":13,"column":0},"generated":{"line":2,"column":214}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":14,"column":0},"generated":{"line":2,"column":216}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":14,"column":0},"generated":{"line":2,"column":228}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":14,"column":0},"generated":{"line":2,"column":230}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":15,"column":0},"generated":{"line":2,"column":233}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":15,"column":0},"generated":{"line":2,"column":238}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":15,"column":0},"generated":{"line":2,"column":244}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":16,"column":0},"generated":{"line":2,"column":246}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":16,"column":0},"generated":{"line":2,"column":251}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":16,"column":0},"generated":{"line":2,"column":255}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":17,"column":0},"generated":{"line":2,"column":257}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":17,"column":0},"generated":{"line":2,"column":262}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":17,"column":0},"generated":{"line":2,"column":277}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":19,"column":0},"generated":{"line":2,"column":280}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":19,"column":0},"generated":{"line":2,"column":287}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":19,"column":0},"generated":{"line":2,"column":292}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":19,"column":0},"generated":{"line":2,"column":298}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":20,"column":0},"generated":{"line":2,"column":306}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":20,"column":0},"generated":{"line":2,"column":308}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":20,"column":0},"generated":{"line":2,"column":314}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":22,"column":0},"generated":{"line":2,"column":407}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":22,"column":0},"generated":{"line":2,"column":412}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":22,"column":0},"generated":{"line":2,"column":427}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":22,"column":0},"generated":{"line":2,"column":432}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":22,"column":0},"generated":{"line":2,"column":447}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":22,"column":0},"generated":{"line":2,"column":452}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":26,"column":0},"generated":{"line":2,"column":458}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":26,"column":0},"generated":{"line":2,"column":463}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":26,"column":0},"generated":{"line":2,"column":469}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":27,"column":0},"generated":{"line":2,"column":486}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":27,"column":0},"generated":{"line":2,"column":491}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":27,"column":0},"generated":{"line":2,"column":497}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":27,"column":0},"generated":{"line":2,"column":513}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":30,"column":0},"generated":{"line":2,"column":516}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":30,"column":0},"generated":{"line":2,"column":532}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":30,"column":0},"generated":{"line":2,"column":534}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":30,"column":0},"generated":{"line":2,"column":536}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":31,"column":0},"generated":{"line":2,"column":539}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":31,"column":0},"generated":{"line":2,"column":543}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":31,"column":0},"generated":{"line":2,"column":548}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":31,"column":0},"generated":{"line":2,"column":563}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":31,"column":0},"generated":{"line":2,"column":567}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":31,"column":0},"generated":{"line":2,"column":572}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":31,"column":0},"generated":{"line":2,"column":578}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":31,"column":0},"generated":{"line":2,"column":585}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":32,"column":0},"generated":{"line":2,"column":592}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":32,"column":0},"generated":{"line":2,"column":597}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":32,"column":0},"generated":{"line":2,"column":603}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":32,"column":0},"generated":{"line":2,"column":610}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":32,"column":0},"generated":{"line":2,"column":620}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":32,"column":0},"generated":{"line":2,"column":622}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":32,"column":0},"generated":{"line":2,"column":627}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":34,"column":0},"generated":{"line":2,"column":643}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":34,"column":0},"generated":{"line":2,"column":649}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":34,"column":0},"generated":{"line":2,"column":651}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":34,"column":0},"generated":{"line":2,"column":655}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":34,"column":0},"generated":{"line":2,"column":657}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":34,"column":0},"generated":{"line":2,"column":662}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":34,"column":0},"generated":{"line":2,"column":668}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":34,"column":0},"generated":{"line":2,"column":675}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":36,"column":0},"generated":{"line":2,"column":678}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":36,"column":0},"generated":{"line":2,"column":680}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":36,"column":0},"generated":{"line":2,"column":683}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":36,"column":0},"generated":{"line":2,"column":690}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":37,"column":0},"generated":{"line":2,"column":694}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":37,"column":0},"generated":{"line":2,"column":696}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":37,"column":0},"generated":{"line":2,"column":717}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":38,"column":0},"generated":{"line":2,"column":723}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":38,"column":0},"generated":{"line":2,"column":725}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":38,"column":0},"generated":{"line":2,"column":731}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":39,"column":0},"generated":{"line":2,"column":734}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":39,"column":0},"generated":{"line":2,"column":739}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":39,"column":0},"generated":{"line":2,"column":754}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":40,"column":0},"generated":{"line":2,"column":757}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":40,"column":0},"generated":{"line":2,"column":759}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":40,"column":0},"generated":{"line":2,"column":761}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":42,"column":0},"generated":{"line":2,"column":765}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":42,"column":0},"generated":{"line":2,"column":767}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":42,"column":0},"generated":{"line":2,"column":772}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":43,"column":0},"generated":{"line":2,"column":827}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":43,"column":0},"generated":{"line":2,"column":829}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":43,"column":0},"generated":{"line":2,"column":834}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":43,"column":0},"generated":{"line":2,"column":836}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":47,"column":0},"generated":{"line":2,"column":842}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":47,"column":0},"generated":{"line":2,"column":844}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":47,"column":0},"generated":{"line":2,"column":847}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":47,"column":0},"generated":{"line":2,"column":855}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":47,"column":0},"generated":{"line":2,"column":858}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":47,"column":0},"generated":{"line":2,"column":860}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":47,"column":0},"generated":{"line":2,"column":874}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":47,"column":0},"generated":{"line":2,"column":884}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":48,"column":0},"generated":{"line":2,"column":890}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":48,"column":0},"generated":{"line":2,"column":892}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":48,"column":0},"generated":{"line":2,"column":895}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":48,"column":0},"generated":{"line":2,"column":903}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":48,"column":0},"generated":{"line":2,"column":906}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":48,"column":0},"generated":{"line":2,"column":908}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":48,"column":0},"generated":{"line":2,"column":914}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":50,"column":0},"generated":{"line":2,"column":918}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":50,"column":0},"generated":{"line":2,"column":923}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":50,"column":0},"generated":{"line":2,"column":938}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":50,"column":0},"generated":{"line":2,"column":941}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":51,"column":0},"generated":{"line":2,"column":942}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":51,"column":0},"generated":{"line":2,"column":955}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":52,"column":0},"generated":{"line":2,"column":957}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":52,"column":0},"generated":{"line":2,"column":967}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":53,"column":0},"generated":{"line":2,"column":969}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":53,"column":0},"generated":{"line":2,"column":979}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":56,"column":0},"generated":{"line":2,"column":982}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":57,"column":0},"generated":{"line":2,"column":986}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":57,"column":0},"generated":{"line":2,"column":988}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":57,"column":0},"generated":{"line":2,"column":994}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":57,"column":0},"generated":{"line":2,"column":1009}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":61,"column":0},"generated":{"line":2,"column":1013}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":61,"column":0},"generated":{"line":2,"column":1031}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":62,"column":0},"generated":{"line":2,"column":1034}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":62,"column":0},"generated":{"line":2,"column":1039}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":62,"column":0},"generated":{"line":2,"column":1054}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":63,"column":0},"generated":{"line":2,"column":1065}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":63,"column":0},"generated":{"line":2,"column":1070}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":63,"column":0},"generated":{"line":2,"column":1076}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":63,"column":0},"generated":{"line":2,"column":1083}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":63,"column":0},"generated":{"line":2,"column":1095}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":63,"column":0},"generated":{"line":2,"column":1097}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":63,"column":0},"generated":{"line":2,"column":1102}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":64,"column":0},"generated":{"line":2,"column":1118}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":64,"column":0},"generated":{"line":2,"column":1123}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":64,"column":0},"generated":{"line":2,"column":1138}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":64,"column":0},"generated":{"line":2,"column":1141}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":64,"column":0},"generated":{"line":2,"column":1154}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":65,"column":0},"generated":{"line":2,"column":1168}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":65,"column":0},"generated":{"line":2,"column":1173}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":65,"column":0},"generated":{"line":2,"column":1188}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":66,"column":0},"generated":{"line":2,"column":1191}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":66,"column":0},"generated":{"line":2,"column":1193}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":66,"column":0},"generated":{"line":2,"column":1221}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":67,"column":0},"generated":{"line":2,"column":1227}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":68,"column":0},"generated":{"line":2,"column":1231}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":68,"column":0},"generated":{"line":2,"column":1233}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":68,"column":0},"generated":{"line":2,"column":1239}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":68,"column":0},"generated":{"line":2,"column":1254}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":72,"column":0},"generated":{"line":2,"column":1258}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":72,"column":0},"generated":{"line":2,"column":1266}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":72,"column":0},"generated":{"line":2,"column":1268}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":73,"column":0},"generated":{"line":2,"column":1271}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":73,"column":0},"generated":{"line":2,"column":1276}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":73,"column":0},"generated":{"line":2,"column":1291}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":73,"column":0},"generated":{"line":2,"column":1295}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":73,"column":0},"generated":{"line":2,"column":1300}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":73,"column":0},"generated":{"line":2,"column":1306}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":74,"column":0},"generated":{"line":2,"column":1314}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":74,"column":0},"generated":{"line":2,"column":1319}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":74,"column":0},"generated":{"line":2,"column":1325}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":74,"column":0},"generated":{"line":2,"column":1332}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":74,"column":0},"generated":{"line":2,"column":1340}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":74,"column":0},"generated":{"line":2,"column":1342}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":74,"column":0},"generated":{"line":2,"column":1344}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":74,"column":0},"generated":{"line":2,"column":1349}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":74,"column":0},"generated":{"line":2,"column":1354}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":74,"column":0},"generated":{"line":2,"column":1364}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":78,"column":0},"generated":{"line":2,"column":1369}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":79,"column":0},"generated":{"line":2,"column":1388}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":79,"column":0},"generated":{"line":2,"column":1394}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":79,"column":0},"generated":{"line":2,"column":1396}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":79,"column":0},"generated":{"line":2,"column":1403}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":79,"column":0},"generated":{"line":2,"column":1408}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":79,"column":0},"generated":{"line":2,"column":1413}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":80,"column":0},"generated":{"line":2,"column":1435}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":80,"column":0},"generated":{"line":2,"column":1437}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":80,"column":0},"generated":{"line":2,"column":1439}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":80,"column":0},"generated":{"line":2,"column":1443}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":80,"column":0},"generated":{"line":2,"column":1446}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":80,"column":0},"generated":{"line":2,"column":1451}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":80,"column":0},"generated":{"line":2,"column":1463}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":80,"column":0},"generated":{"line":2,"column":1468}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":80,"column":0},"generated":{"line":2,"column":1473}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":81,"column":0},"generated":{"line":2,"column":1478}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":81,"column":0},"generated":{"line":2,"column":1483}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":81,"column":0},"generated":{"line":2,"column":1498}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":84,"column":0},"generated":{"line":2,"column":1501}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":84,"column":0},"generated":{"line":2,"column":1522}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":86,"column":0},"generated":{"line":2,"column":1525}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":86,"column":0},"generated":{"line":2,"column":1528}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":86,"column":0},"generated":{"line":2,"column":1530}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":86,"column":0},"generated":{"line":2,"column":1537}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":86,"column":0},"generated":{"line":2,"column":1542}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":87,"column":0},"generated":{"line":2,"column":1546}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":90,"column":0},"generated":{"line":2,"column":1553}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":90,"column":0},"generated":{"line":2,"column":1557}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":90,"column":0},"generated":{"line":2,"column":1559}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":90,"column":0},"generated":{"line":2,"column":1561}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":91,"column":0},"generated":{"line":2,"column":1563}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":93,"column":0},"generated":{"line":2,"column":1567}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":93,"column":0},"generated":{"line":2,"column":1569}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":93,"column":0},"generated":{"line":2,"column":1571}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":93,"column":0},"generated":{"line":2,"column":1580}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":94,"column":0},"generated":{"line":2,"column":1583}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":94,"column":0},"generated":{"line":2,"column":1585}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":94,"column":0},"generated":{"line":2,"column":1590}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":94,"column":0},"generated":{"line":2,"column":1596}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":94,"column":0},"generated":{"line":2,"column":1598}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":95,"column":0},"generated":{"line":2,"column":1604}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":95,"column":0},"generated":{"line":2,"column":1606}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":95,"column":0},"generated":{"line":2,"column":1611}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":95,"column":0},"generated":{"line":2,"column":1626}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":96,"column":0},"generated":{"line":2,"column":1629}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":96,"column":0},"generated":{"line":2,"column":1635}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":97,"column":0},"generated":{"line":2,"column":1638}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":97,"column":0},"generated":{"line":2,"column":1640}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":97,"column":0},"generated":{"line":2,"column":1646}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":98,"column":0},"generated":{"line":2,"column":1649}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":98,"column":0},"generated":{"line":2,"column":1651}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":98,"column":0},"generated":{"line":2,"column":1657}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":98,"column":0},"generated":{"line":2,"column":1690}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":101,"column":0},"generated":{"line":2,"column":1693}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":101,"column":0},"generated":{"line":2,"column":1696}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":101,"column":0},"generated":{"line":2,"column":1698}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":101,"column":0},"generated":{"line":2,"column":1709}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":102,"column":0},"generated":{"line":2,"column":1718}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":102,"column":0},"generated":{"line":2,"column":1720}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":102,"column":0},"generated":{"line":2,"column":1730}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":102,"column":0},"generated":{"line":2,"column":1732}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":102,"column":0},"generated":{"line":2,"column":1734}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":102,"column":0},"generated":{"line":2,"column":1736}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":107,"column":0},"generated":{"line":2,"column":1743}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":107,"column":0},"generated":{"line":2,"column":1750}},{"source":"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js","original":{"line":107,"column":0},"generated":{"line":2,"column":1758}}],"sources":{"node_modules/orbit-db-pubsub/src/ipfs-pubsub.js":"'use strict'\n\nconst pSeries = require('p-series')\nconst PeerMonitor = require('ipfs-pubsub-peer-monitor')\n\nconst Logger = require('logplease')\nconst logger = Logger.create(\"pubsub\", { color: Logger.Colors.Yellow })\nLogger.setLogLevel('ERROR')\n\nconst maxTopicsOpen = 256\nlet topicsOpenCount = 0\n\nclass IPFSPubsub {\n  constructor(ipfs, id) {\n    this._ipfs = ipfs\n    this._id = id\n    this._subscriptions = {}\n\n    if (this._ipfs.pubsub === null)\n      logger.error(\"The provided version of ipfs doesn't have pubsub support. Messages will not be exchanged.\")\n\n    this._handleMessage = this._handleMessage.bind(this)\n\n    // Bump up the number of listeners we can have open,\n    // ie. number of databases replicating\n    if (this._ipfs.setMaxListeners)\n      this._ipfs.setMaxListeners(maxTopicsOpen)\n  }\n\n  async subscribe(topic, onMessageCallback, onNewPeerCallback) {\n    if(!this._subscriptions[topic] && this._ipfs.pubsub) {\n      await this._ipfs.pubsub.subscribe(topic, this._handleMessage)\n\n      const topicMonitor = new PeerMonitor(this._ipfs.pubsub, topic)\n\n      topicMonitor.on('join', (peer) => {\n        logger.debug(`Peer joined ${topic}:`)\n        logger.debug(peer)\n        if (this._subscriptions[topic]) {\n          onNewPeerCallback(topic, peer)\n        } else {\n          logger.warn('Peer joined a room we don\\'t have a subscription for')\n          logger.warn(topic, peer)\n        }\n      })\n\n      topicMonitor.on('leave', (peer) => logger.debug(`Peer ${peer} left ${topic}`))\n      topicMonitor.on('error', (e) => logger.error(e))\n\n      this._subscriptions[topic] = {\n        topicMonitor: topicMonitor,\n        onMessage: onMessageCallback,\n        onNewPeer: onNewPeerCallback\n      }\n\n      topicsOpenCount ++\n      logger.debug(\"Topics open:\", topicsOpenCount)\n    }\n  }\n\n  async unsubscribe(hash) {\n    if(this._subscriptions[hash]) {\n      await this._ipfs.pubsub.unsubscribe(hash, this._handleMessage)\n      this._subscriptions[hash].topicMonitor.stop()\n      delete this._subscriptions[hash]\n      logger.debug(`Unsubscribed from '${hash}'`)\n      topicsOpenCount --\n      logger.debug(\"Topics open:\", topicsOpenCount)\n    }\n  }\n\n  publish(topic, message) {\n    if(this._subscriptions[topic] && this._ipfs.pubsub) {\n      this._ipfs.pubsub.publish(topic, Buffer.from(JSON.stringify(message)))\n    }\n  }\n\n  async disconnect() {\n    const topics = Object.keys(this._subscriptions)\n    await pSeries(topics.map((t) => this.unsubscribe.bind(this, t)))\n    this._subscriptions = {}\n  }\n\n  async _handleMessage(message) {\n    // Don't process our own messages\n    if (message.from === this._id)\n      return\n\n    // Get the message content and a subscription\n    let content, subscription, topicId\n    try {\n      // Get the topic\n      topicId = message.topicIDs[0]\n      content = JSON.parse(message.data)\n      subscription = this._subscriptions[topicId]\n    } catch (e) {\n      logger.error(e)\n      logger.error('Couldn\\'t parse pubsub message:', message)\n    }\n\n    if(subscription && subscription.onMessage && content) {\n      await subscription.onMessage(topicId, content, message.from)\n    }\n  }\n}\n\nmodule.exports = IPFSPubsub\n"},"lineCount":null}},"error":null,"hash":"adb245a1dbfcc77fc75b1df95cfba57a","cacheData":{"env":{}}}