{"id":"MqFv","dependencies":[{"name":"/Users/polluterofminds/Development/simpleid/ssa-sdk/package.json","includedInParent":true,"mtime":1584306008866},{"name":"/Users/polluterofminds/Development/simpleid/ssa-sdk/node_modules/ipfs/package.json","includedInParent":true,"mtime":1582579778668},{"name":"pull-stream/pull","loc":{"line":3,"column":21},"parent":"/Users/polluterofminds/Development/simpleid/ssa-sdk/node_modules/ipfs/src/core/components/pin/gc-lock.js","resolved":"/Users/polluterofminds/Development/simpleid/ssa-sdk/node_modules/ipfs/node_modules/pull-stream/pull.js"},{"name":"pull-stream/throughs/through","loc":{"line":4,"column":28},"parent":"/Users/polluterofminds/Development/simpleid/ssa-sdk/node_modules/ipfs/src/core/components/pin/gc-lock.js","resolved":"/Users/polluterofminds/Development/simpleid/ssa-sdk/node_modules/ipfs/node_modules/pull-stream/throughs/through.js"},{"name":"pull-stream/throughs/async-map","loc":{"line":5,"column":29},"parent":"/Users/polluterofminds/Development/simpleid/ssa-sdk/node_modules/ipfs/src/core/components/pin/gc-lock.js","resolved":"/Users/polluterofminds/Development/simpleid/ssa-sdk/node_modules/ipfs/node_modules/pull-stream/throughs/async-map.js"},{"name":"../../../utils/mutex","loc":{"line":6,"column":22},"parent":"/Users/polluterofminds/Development/simpleid/ssa-sdk/node_modules/ipfs/src/core/components/pin/gc-lock.js","resolved":"/Users/polluterofminds/Development/simpleid/ssa-sdk/node_modules/ipfs/src/utils/mutex.js"},{"name":"debug","loc":{"line":7,"column":20},"parent":"/Users/polluterofminds/Development/simpleid/ssa-sdk/node_modules/ipfs/src/core/components/pin/gc-lock.js","resolved":"/Users/polluterofminds/Development/simpleid/ssa-sdk/node_modules/ipfs/node_modules/debug/src/browser.js"}],"generated":{"js":"\"use strict\";const e=require(\"pull-stream/pull\"),t=require(\"pull-stream/throughs/through\"),r=require(\"pull-stream/throughs/async-map\"),u=require(\"../../../utils/mutex\"),s=require(\"debug\")(\"ipfs:gc:lock\");class l{constructor(e,t){t=t||{},this.mutex=new u(e,{...t,log:s})}readLock(){return this.mutex.readLock()}writeLock(){return this.mutex.writeLock()}pullReadLock(e){return this.pullLock(\"readLock\",e)}pullWriteLock(e){return this.pullLock(\"writeLock\",e)}pullLock(t,r){const u=new o(this.mutex,t);return e(u.take(),r(),u.release())}}class o{constructor(e,t){this.mutex=e,this.type=t,this.releaseLock=null}take(){return r((e,t)=>{if(this.releaseLock)return t(null,e);this.mutex[this.type]().then(r=>{this.releaseLock=r,t(null,e)},t)})}release(){return t(null,e=>{this.releaseLock(e)})}}module.exports=l;"},"sourceMaps":{"js":{"mappings":[{"source":"node_modules/ipfs/src/core/components/pin/gc-lock.js","original":{"line":1,"column":0},"generated":{"line":1,"column":0}},{"source":"node_modules/ipfs/src/core/components/pin/gc-lock.js","original":{"line":3,"column":0},"generated":{"line":1,"column":13}},{"source":"node_modules/ipfs/src/core/components/pin/gc-lock.js","name":"pull","original":{"line":3,"column":6},"generated":{"line":1,"column":19}},{"source":"node_modules/ipfs/src/core/components/pin/gc-lock.js","name":"require","original":{"line":3,"column":13},"generated":{"line":1,"column":21}},{"source":"node_modules/ipfs/src/core/components/pin/gc-lock.js","original":{"line":3,"column":21},"generated":{"line":1,"column":29}},{"source":"node_modules/ipfs/src/core/components/pin/gc-lock.js","name":"pullThrough","original":{"line":4,"column":6},"generated":{"line":1,"column":49}},{"source":"node_modules/ipfs/src/core/components/pin/gc-lock.js","name":"require","original":{"line":4,"column":20},"generated":{"line":1,"column":51}},{"source":"node_modules/ipfs/src/core/components/pin/gc-lock.js","original":{"line":4,"column":28},"generated":{"line":1,"column":59}},{"source":"node_modules/ipfs/src/core/components/pin/gc-lock.js","name":"pullAsyncMap","original":{"line":5,"column":6},"generated":{"line":1,"column":91}},{"source":"node_modules/ipfs/src/core/components/pin/gc-lock.js","name":"require","original":{"line":5,"column":21},"generated":{"line":1,"column":93}},{"source":"node_modules/ipfs/src/core/components/pin/gc-lock.js","original":{"line":5,"column":29},"generated":{"line":1,"column":101}},{"source":"node_modules/ipfs/src/core/components/pin/gc-lock.js","name":"Mutex","original":{"line":6,"column":6},"generated":{"line":1,"column":135}},{"source":"node_modules/ipfs/src/core/components/pin/gc-lock.js","name":"require","original":{"line":6,"column":14},"generated":{"line":1,"column":137}},{"source":"node_modules/ipfs/src/core/components/pin/gc-lock.js","original":{"line":6,"column":22},"generated":{"line":1,"column":145}},{"source":"node_modules/ipfs/src/core/components/pin/gc-lock.js","name":"log","original":{"line":7,"column":6},"generated":{"line":1,"column":169}},{"source":"node_modules/ipfs/src/core/components/pin/gc-lock.js","name":"require","original":{"line":7,"column":12},"generated":{"line":1,"column":171}},{"source":"node_modules/ipfs/src/core/components/pin/gc-lock.js","original":{"line":7,"column":20},"generated":{"line":1,"column":179}},{"source":"node_modules/ipfs/src/core/components/pin/gc-lock.js","name":"require","original":{"line":7,"column":12},"generated":{"line":1,"column":187}},{"source":"node_modules/ipfs/src/core/components/pin/gc-lock.js","original":{"line":7,"column":29},"generated":{"line":1,"column":188}},{"source":"node_modules/ipfs/src/core/components/pin/gc-lock.js","original":{"line":9,"column":0},"generated":{"line":1,"column":204}},{"source":"node_modules/ipfs/src/core/components/pin/gc-lock.js","name":"GCLock","original":{"line":9,"column":6},"generated":{"line":1,"column":210}},{"source":"node_modules/ipfs/src/core/components/pin/gc-lock.js","name":"constructor","original":{"line":10,"column":2},"generated":{"line":1,"column":212}},{"source":"node_modules/ipfs/src/core/components/pin/gc-lock.js","name":"repoOwner","original":{"line":10,"column":15},"generated":{"line":1,"column":224}},{"source":"node_modules/ipfs/src/core/components/pin/gc-lock.js","name":"options","original":{"line":10,"column":26},"generated":{"line":1,"column":226}},{"source":"node_modules/ipfs/src/core/components/pin/gc-lock.js","name":"options","original":{"line":11,"column":4},"generated":{"line":1,"column":229}},{"source":"node_modules/ipfs/src/core/components/pin/gc-lock.js","name":"options","original":{"line":11,"column":14},"generated":{"line":1,"column":231}},{"source":"node_modules/ipfs/src/core/components/pin/gc-lock.js","original":{"line":11,"column":25},"generated":{"line":1,"column":234}},{"source":"node_modules/ipfs/src/core/components/pin/gc-lock.js","name":"mutex","original":{"line":13,"column":9},"generated":{"line":1,"column":237}},{"source":"node_modules/ipfs/src/core/components/pin/gc-lock.js","name":"mutex","original":{"line":13,"column":9},"generated":{"line":1,"column":242}},{"source":"node_modules/ipfs/src/core/components/pin/gc-lock.js","original":{"line":13,"column":17},"generated":{"line":1,"column":248}},{"source":"node_modules/ipfs/src/core/components/pin/gc-lock.js","name":"Mutex","original":{"line":13,"column":21},"generated":{"line":1,"column":252}},{"source":"node_modules/ipfs/src/core/components/pin/gc-lock.js","name":"repoOwner","original":{"line":13,"column":27},"generated":{"line":1,"column":254}},{"source":"node_modules/ipfs/src/core/components/pin/gc-lock.js","original":{"line":13,"column":38},"generated":{"line":1,"column":256}},{"source":"node_modules/ipfs/src/core/components/pin/gc-lock.js","name":"options","original":{"line":13,"column":43},"generated":{"line":1,"column":260}},{"source":"node_modules/ipfs/src/core/components/pin/gc-lock.js","name":"log","original":{"line":13,"column":52},"generated":{"line":1,"column":262}},{"source":"node_modules/ipfs/src/core/components/pin/gc-lock.js","name":"log","original":{"line":13,"column":52},"generated":{"line":1,"column":266}},{"source":"node_modules/ipfs/src/core/components/pin/gc-lock.js","name":"readLock","original":{"line":16,"column":2},"generated":{"line":1,"column":270}},{"source":"node_modules/ipfs/src/core/components/pin/gc-lock.js","original":{"line":17,"column":11},"generated":{"line":1,"column":281}},{"source":"node_modules/ipfs/src/core/components/pin/gc-lock.js","original":{"line":17,"column":11},"generated":{"line":1,"column":288}},{"source":"node_modules/ipfs/src/core/components/pin/gc-lock.js","name":"mutex","original":{"line":17,"column":16},"generated":{"line":1,"column":293}},{"source":"node_modules/ipfs/src/core/components/pin/gc-lock.js","name":"readLock","original":{"line":17,"column":22},"generated":{"line":1,"column":299}},{"source":"node_modules/ipfs/src/core/components/pin/gc-lock.js","name":"writeLock","original":{"line":20,"column":2},"generated":{"line":1,"column":310}},{"source":"node_modules/ipfs/src/core/components/pin/gc-lock.js","original":{"line":21,"column":11},"generated":{"line":1,"column":322}},{"source":"node_modules/ipfs/src/core/components/pin/gc-lock.js","original":{"line":21,"column":11},"generated":{"line":1,"column":329}},{"source":"node_modules/ipfs/src/core/components/pin/gc-lock.js","name":"mutex","original":{"line":21,"column":16},"generated":{"line":1,"column":334}},{"source":"node_modules/ipfs/src/core/components/pin/gc-lock.js","name":"writeLock","original":{"line":21,"column":22},"generated":{"line":1,"column":340}},{"source":"node_modules/ipfs/src/core/components/pin/gc-lock.js","name":"pullReadLock","original":{"line":24,"column":2},"generated":{"line":1,"column":352}},{"source":"node_modules/ipfs/src/core/components/pin/gc-lock.js","name":"lockedPullFn","original":{"line":24,"column":16},"generated":{"line":1,"column":365}},{"source":"node_modules/ipfs/src/core/components/pin/gc-lock.js","original":{"line":25,"column":11},"generated":{"line":1,"column":368}},{"source":"node_modules/ipfs/src/core/components/pin/gc-lock.js","original":{"line":25,"column":11},"generated":{"line":1,"column":375}},{"source":"node_modules/ipfs/src/core/components/pin/gc-lock.js","name":"pullLock","original":{"line":25,"column":16},"generated":{"line":1,"column":380}},{"source":"node_modules/ipfs/src/core/components/pin/gc-lock.js","original":{"line":25,"column":25},"generated":{"line":1,"column":389}},{"source":"node_modules/ipfs/src/core/components/pin/gc-lock.js","name":"lockedPullFn","original":{"line":25,"column":37},"generated":{"line":1,"column":400}},{"source":"node_modules/ipfs/src/core/components/pin/gc-lock.js","name":"pullWriteLock","original":{"line":28,"column":2},"generated":{"line":1,"column":403}},{"source":"node_modules/ipfs/src/core/components/pin/gc-lock.js","name":"lockedPullFn","original":{"line":28,"column":17},"generated":{"line":1,"column":417}},{"source":"node_modules/ipfs/src/core/components/pin/gc-lock.js","original":{"line":29,"column":11},"generated":{"line":1,"column":420}},{"source":"node_modules/ipfs/src/core/components/pin/gc-lock.js","original":{"line":29,"column":11},"generated":{"line":1,"column":427}},{"source":"node_modules/ipfs/src/core/components/pin/gc-lock.js","name":"pullLock","original":{"line":29,"column":16},"generated":{"line":1,"column":432}},{"source":"node_modules/ipfs/src/core/components/pin/gc-lock.js","original":{"line":29,"column":25},"generated":{"line":1,"column":441}},{"source":"node_modules/ipfs/src/core/components/pin/gc-lock.js","name":"lockedPullFn","original":{"line":29,"column":38},"generated":{"line":1,"column":453}},{"source":"node_modules/ipfs/src/core/components/pin/gc-lock.js","name":"pullLock","original":{"line":32,"column":2},"generated":{"line":1,"column":456}},{"source":"node_modules/ipfs/src/core/components/pin/gc-lock.js","name":"type","original":{"line":32,"column":12},"generated":{"line":1,"column":465}},{"source":"node_modules/ipfs/src/core/components/pin/gc-lock.js","name":"lockedPullFn","original":{"line":32,"column":18},"generated":{"line":1,"column":467}},{"source":"node_modules/ipfs/src/core/components/pin/gc-lock.js","name":"pullLocker","original":{"line":33,"column":10},"generated":{"line":1,"column":470}},{"source":"node_modules/ipfs/src/core/components/pin/gc-lock.js","name":"pullLocker","original":{"line":33,"column":10},"generated":{"line":1,"column":476}},{"source":"node_modules/ipfs/src/core/components/pin/gc-lock.js","original":{"line":33,"column":23},"generated":{"line":1,"column":478}},{"source":"node_modules/ipfs/src/core/components/pin/gc-lock.js","name":"PullLocker","original":{"line":33,"column":27},"generated":{"line":1,"column":482}},{"source":"node_modules/ipfs/src/core/components/pin/gc-lock.js","original":{"line":33,"column":38},"generated":{"line":1,"column":484}},{"source":"node_modules/ipfs/src/core/components/pin/gc-lock.js","name":"mutex","original":{"line":33,"column":43},"generated":{"line":1,"column":489}},{"source":"node_modules/ipfs/src/core/components/pin/gc-lock.js","name":"type","original":{"line":33,"column":50},"generated":{"line":1,"column":495}},{"source":"node_modules/ipfs/src/core/components/pin/gc-lock.js","name":"pull","original":{"line":35,"column":11},"generated":{"line":1,"column":498}},{"source":"node_modules/ipfs/src/core/components/pin/gc-lock.js","name":"pull","original":{"line":35,"column":11},"generated":{"line":1,"column":505}},{"source":"node_modules/ipfs/src/core/components/pin/gc-lock.js","name":"pullLocker","original":{"line":36,"column":6},"generated":{"line":1,"column":507}},{"source":"node_modules/ipfs/src/core/components/pin/gc-lock.js","name":"take","original":{"line":36,"column":17},"generated":{"line":1,"column":509}},{"source":"node_modules/ipfs/src/core/components/pin/gc-lock.js","name":"lockedPullFn","original":{"line":37,"column":6},"generated":{"line":1,"column":516}},{"source":"node_modules/ipfs/src/core/components/pin/gc-lock.js","name":"pullLocker","original":{"line":38,"column":6},"generated":{"line":1,"column":520}},{"source":"node_modules/ipfs/src/core/components/pin/gc-lock.js","name":"release","original":{"line":38,"column":17},"generated":{"line":1,"column":522}},{"source":"node_modules/ipfs/src/core/components/pin/gc-lock.js","original":{"line":43,"column":0},"generated":{"line":1,"column":534}},{"source":"node_modules/ipfs/src/core/components/pin/gc-lock.js","name":"PullLocker","original":{"line":43,"column":6},"generated":{"line":1,"column":540}},{"source":"node_modules/ipfs/src/core/components/pin/gc-lock.js","name":"constructor","original":{"line":44,"column":2},"generated":{"line":1,"column":542}},{"source":"node_modules/ipfs/src/core/components/pin/gc-lock.js","name":"mutex","original":{"line":44,"column":15},"generated":{"line":1,"column":554}},{"source":"node_modules/ipfs/src/core/components/pin/gc-lock.js","name":"type","original":{"line":44,"column":22},"generated":{"line":1,"column":556}},{"source":"node_modules/ipfs/src/core/components/pin/gc-lock.js","name":"mutex","original":{"line":45,"column":9},"generated":{"line":1,"column":559}},{"source":"node_modules/ipfs/src/core/components/pin/gc-lock.js","name":"mutex","original":{"line":45,"column":9},"generated":{"line":1,"column":564}},{"source":"node_modules/ipfs/src/core/components/pin/gc-lock.js","name":"mutex","original":{"line":45,"column":17},"generated":{"line":1,"column":570}},{"source":"node_modules/ipfs/src/core/components/pin/gc-lock.js","name":"type","original":{"line":46,"column":9},"generated":{"line":1,"column":572}},{"source":"node_modules/ipfs/src/core/components/pin/gc-lock.js","name":"type","original":{"line":46,"column":9},"generated":{"line":1,"column":577}},{"source":"node_modules/ipfs/src/core/components/pin/gc-lock.js","name":"type","original":{"line":46,"column":16},"generated":{"line":1,"column":582}},{"source":"node_modules/ipfs/src/core/components/pin/gc-lock.js","name":"releaseLock","original":{"line":49,"column":9},"generated":{"line":1,"column":584}},{"source":"node_modules/ipfs/src/core/components/pin/gc-lock.js","name":"releaseLock","original":{"line":49,"column":9},"generated":{"line":1,"column":589}},{"source":"node_modules/ipfs/src/core/components/pin/gc-lock.js","original":{"line":49,"column":23},"generated":{"line":1,"column":601}},{"source":"node_modules/ipfs/src/core/components/pin/gc-lock.js","name":"take","original":{"line":52,"column":2},"generated":{"line":1,"column":606}},{"source":"node_modules/ipfs/src/core/components/pin/gc-lock.js","name":"pullAsyncMap","original":{"line":53,"column":11},"generated":{"line":1,"column":613}},{"source":"node_modules/ipfs/src/core/components/pin/gc-lock.js","name":"pullAsyncMap","original":{"line":53,"column":11},"generated":{"line":1,"column":620}},{"source":"node_modules/ipfs/src/core/components/pin/gc-lock.js","original":{"line":53,"column":24},"generated":{"line":1,"column":622}},{"source":"node_modules/ipfs/src/core/components/pin/gc-lock.js","name":"i","original":{"line":53,"column":25},"generated":{"line":1,"column":623}},{"source":"node_modules/ipfs/src/core/components/pin/gc-lock.js","name":"cb","original":{"line":53,"column":28},"generated":{"line":1,"column":625}},{"source":"node_modules/ipfs/src/core/components/pin/gc-lock.js","original":{"line":57,"column":10},"generated":{"line":1,"column":630}},{"source":"node_modules/ipfs/src/core/components/pin/gc-lock.js","original":{"line":57,"column":10},"generated":{"line":1,"column":633}},{"source":"node_modules/ipfs/src/core/components/pin/gc-lock.js","name":"releaseLock","original":{"line":57,"column":15},"generated":{"line":1,"column":638}},{"source":"node_modules/ipfs/src/core/components/pin/gc-lock.js","name":"cb","original":{"line":59,"column":15},"generated":{"line":1,"column":650}},{"source":"node_modules/ipfs/src/core/components/pin/gc-lock.js","name":"cb","original":{"line":59,"column":15},"generated":{"line":1,"column":657}},{"source":"node_modules/ipfs/src/core/components/pin/gc-lock.js","original":{"line":59,"column":18},"generated":{"line":1,"column":659}},{"source":"node_modules/ipfs/src/core/components/pin/gc-lock.js","name":"i","original":{"line":59,"column":24},"generated":{"line":1,"column":664}},{"source":"node_modules/ipfs/src/core/components/pin/gc-lock.js","name":"mutex","original":{"line":63,"column":11},"generated":{"line":1,"column":667}},{"source":"node_modules/ipfs/src/core/components/pin/gc-lock.js","name":"mutex","original":{"line":63,"column":11},"generated":{"line":1,"column":672}},{"source":"node_modules/ipfs/src/core/components/pin/gc-lock.js","original":{"line":63,"column":17},"generated":{"line":1,"column":678}},{"source":"node_modules/ipfs/src/core/components/pin/gc-lock.js","name":"type","original":{"line":63,"column":22},"generated":{"line":1,"column":683}},{"source":"node_modules/ipfs/src/core/components/pin/gc-lock.js","name":"then","original":{"line":64,"column":9},"generated":{"line":1,"column":691}},{"source":"node_modules/ipfs/src/core/components/pin/gc-lock.js","name":"release","original":{"line":64,"column":14},"generated":{"line":1,"column":696}},{"source":"node_modules/ipfs/src/core/components/pin/gc-lock.js","name":"releaseLock","original":{"line":66,"column":15},"generated":{"line":1,"column":700}},{"source":"node_modules/ipfs/src/core/components/pin/gc-lock.js","name":"releaseLock","original":{"line":66,"column":15},"generated":{"line":1,"column":705}},{"source":"node_modules/ipfs/src/core/components/pin/gc-lock.js","name":"release","original":{"line":66,"column":29},"generated":{"line":1,"column":717}},{"source":"node_modules/ipfs/src/core/components/pin/gc-lock.js","name":"cb","original":{"line":69,"column":10},"generated":{"line":1,"column":719}},{"source":"node_modules/ipfs/src/core/components/pin/gc-lock.js","original":{"line":69,"column":13},"generated":{"line":1,"column":721}},{"source":"node_modules/ipfs/src/core/components/pin/gc-lock.js","name":"i","original":{"line":69,"column":19},"generated":{"line":1,"column":726}},{"source":"node_modules/ipfs/src/core/components/pin/gc-lock.js","name":"cb","original":{"line":70,"column":11},"generated":{"line":1,"column":730}},{"source":"node_modules/ipfs/src/core/components/pin/gc-lock.js","name":"release","original":{"line":75,"column":2},"generated":{"line":1,"column":735}},{"source":"node_modules/ipfs/src/core/components/pin/gc-lock.js","name":"pullThrough","original":{"line":76,"column":11},"generated":{"line":1,"column":745}},{"source":"node_modules/ipfs/src/core/components/pin/gc-lock.js","name":"pullThrough","original":{"line":76,"column":11},"generated":{"line":1,"column":752}},{"source":"node_modules/ipfs/src/core/components/pin/gc-lock.js","original":{"line":76,"column":23},"generated":{"line":1,"column":754}},{"source":"node_modules/ipfs/src/core/components/pin/gc-lock.js","name":"err","original":{"line":76,"column":30},"generated":{"line":1,"column":759}},{"source":"node_modules/ipfs/src/core/components/pin/gc-lock.js","name":"releaseLock","original":{"line":78,"column":11},"generated":{"line":1,"column":763}},{"source":"node_modules/ipfs/src/core/components/pin/gc-lock.js","name":"releaseLock","original":{"line":78,"column":11},"generated":{"line":1,"column":768}},{"source":"node_modules/ipfs/src/core/components/pin/gc-lock.js","name":"err","original":{"line":78,"column":23},"generated":{"line":1,"column":780}},{"source":"node_modules/ipfs/src/core/components/pin/gc-lock.js","name":"module","original":{"line":83,"column":0},"generated":{"line":1,"column":786}},{"source":"node_modules/ipfs/src/core/components/pin/gc-lock.js","name":"exports","original":{"line":83,"column":7},"generated":{"line":1,"column":793}},{"source":"node_modules/ipfs/src/core/components/pin/gc-lock.js","name":"GCLock","original":{"line":83,"column":17},"generated":{"line":1,"column":801}}],"sources":{"node_modules/ipfs/src/core/components/pin/gc-lock.js":"'use strict'\n\nconst pull = require('pull-stream/pull')\nconst pullThrough = require('pull-stream/throughs/through')\nconst pullAsyncMap = require('pull-stream/throughs/async-map')\nconst Mutex = require('../../../utils/mutex')\nconst log = require('debug')('ipfs:gc:lock')\n\nclass GCLock {\n  constructor (repoOwner, options) {\n    options = options || {}\n\n    this.mutex = new Mutex(repoOwner, { ...options, log })\n  }\n\n  readLock () {\n    return this.mutex.readLock()\n  }\n\n  writeLock () {\n    return this.mutex.writeLock()\n  }\n\n  pullReadLock (lockedPullFn) {\n    return this.pullLock('readLock', lockedPullFn)\n  }\n\n  pullWriteLock (lockedPullFn) {\n    return this.pullLock('writeLock', lockedPullFn)\n  }\n\n  pullLock (type, lockedPullFn) {\n    const pullLocker = new PullLocker(this.mutex, type)\n\n    return pull(\n      pullLocker.take(),\n      lockedPullFn(),\n      pullLocker.release()\n    )\n  }\n}\n\nclass PullLocker {\n  constructor (mutex, type) {\n    this.mutex = mutex\n    this.type = type\n\n    // The function to call to release the lock. It is set when the lock is taken\n    this.releaseLock = null\n  }\n\n  take () {\n    return pullAsyncMap((i, cb) => {\n      // Check if the lock has already been acquired.\n      // Note: new items will only come through the pull stream once the first\n      // item has acquired a lock.\n      if (this.releaseLock) {\n        // The lock has been acquired so return immediately\n        return cb(null, i)\n      }\n\n      // Request the lock\n      this.mutex[this.type]()\n        .then(release => {\n          // Save the release function to be called when the stream completes\n          this.releaseLock = release\n\n          // The lock has been granted, so run the locked piece of code\n          cb(null, i)\n        }, cb)\n    })\n  }\n\n  // Releases the lock\n  release () {\n    return pullThrough(null, (err) => {\n      // When the stream completes, release the lock\n      this.releaseLock(err)\n    })\n  }\n}\n\nmodule.exports = GCLock\n"},"lineCount":null}},"error":null,"hash":"482f182d2299c761fc0711cd3dfa192a","cacheData":{"env":{}}}