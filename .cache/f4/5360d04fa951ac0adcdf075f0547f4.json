{"id":"qXHY","dependencies":[{"name":"/Users/polluterofminds/Development/simpleid/ssa-sdk/package.json","includedInParent":true,"mtime":1584306008866},{"name":"/Users/polluterofminds/Development/simpleid/ssa-sdk/node_modules/datastore-core/package.json","includedInParent":true,"mtime":1582579787025},{"name":"interface-datastore","loc":{"line":3,"column":20},"parent":"/Users/polluterofminds/Development/simpleid/ssa-sdk/node_modules/datastore-core/src/sharding.js","resolved":"/Users/polluterofminds/Development/simpleid/ssa-sdk/node_modules/datastore-core/node_modules/interface-datastore/src/index.js"},{"name":"./shard","loc":{"line":5,"column":19},"parent":"/Users/polluterofminds/Development/simpleid/ssa-sdk/node_modules/datastore-core/src/sharding.js","resolved":"/Users/polluterofminds/Development/simpleid/ssa-sdk/node_modules/datastore-core/src/shard.js"},{"name":"./keytransform","loc":{"line":6,"column":34},"parent":"/Users/polluterofminds/Development/simpleid/ssa-sdk/node_modules/datastore-core/src/sharding.js","resolved":"/Users/polluterofminds/Development/simpleid/ssa-sdk/node_modules/datastore-core/src/keytransform.js"},{"name":"buffer","parent":"/Users/polluterofminds/Development/simpleid/ssa-sdk/node_modules/datastore-core/src/sharding.js","resolved":"/Users/polluterofminds/Development/simpleid/ssa-sdk/node_modules/node-libs-browser/node_modules/buffer/index.js"}],"generated":{"js":"var Buffer = require(\"buffer\").Buffer;\nvar t=require(\"buffer\").Buffer;const e=require(\"interface-datastore\").Key,r=require(\"./shard\"),i=require(\"./keytransform\"),n=new e(r.SHARDING_FN),s=new e(r.README_FN);class o{constructor(t,e){this.child=new i(t,{convert:this._convertKey.bind(this),invert:this._invertKey.bind(this)}),this.shard=e}open(){return this.child.open()}_convertKey(t){const r=t.toString();return r===n.toString()||r===s.toString()?t:new e(this.shard.fun(r)).child(t)}_invertKey(t){const r=t.toString();return r===n.toString()||r===s.toString()?t:e.withNamespaces(t.list().slice(1))}static async createOrOpen(t,e){try{await o.create(t,e)}catch(r){if(r&&\"datastore exists\"!==r.message)throw r}return o.open(t)}static async open(t){const e=await r.readShardFun(\"/\",t);return new o(t,e)}static async create(e,i){if(!(await e.has(n))){const o=\"function\"==typeof e.putRaw?e.putRaw.bind(e):e.put.bind(e);return Promise.all([o(n,t.from(i.toString()+\"\\n\")),o(s,t.from(r.readme))])}const o=(await r.readShardFun(\"/\",e)||\"\").toString(),a=i.toString();if(o!==a)throw new Error(`specified fun ${a} does not match repo shard fun ${o}`);throw new Error(\"datastore exists\")}put(t,e){return this.child.put(t,e)}get(t){return this.child.get(t)}has(t){return this.child.has(t)}delete(t){return this.child.delete(t)}batch(){return this.child.batch()}query(t){const e={keysOnly:t.keysOnly,offset:t.offset,limit:t.limit,filters:[t=>t.key.toString()!==n.toString(),t=>t.key.toString()!==s.toString()]};if(null!=t.prefix&&e.filters.push(e=>this._invertKey(e.key).toString().startsWith(t.prefix)),null!=t.filters){const r=t.filters.map(t=>e=>t(Object.assign({},e,{key:this._invertKey(e.key)})));e.filters=e.filters.concat(r)}return null!=t.orders&&(e.orders=t.orders.map(t=>async e=>{e.forEach(t=>{t.key=this._invertKey(t.key)});const r=await t(e);return r.forEach(t=>{t.key=this._convertKey(t.key)}),r})),this.child.query(e)}close(){return this.child.close()}}module.exports=o;"},"sourceMaps":{"js":{"mappings":[{"source":"node_modules/datastore-core/src/sharding.js","original":{"line":140,"column":0},"generated":{"line":2,"column":0}},{"source":"node_modules/datastore-core/src/sharding.js","original":{"line":140,"column":0},"generated":{"line":2,"column":4}},{"source":"node_modules/datastore-core/src/sharding.js","original":{"line":140,"column":0},"generated":{"line":2,"column":6}},{"source":"node_modules/datastore-core/src/sharding.js","original":{"line":140,"column":0},"generated":{"line":2,"column":14}},{"source":"node_modules/datastore-core/src/sharding.js","original":{"line":140,"column":0},"generated":{"line":2,"column":24}},{"source":"node_modules/datastore-core/src/sharding.js","original":{"line":3,"column":0},"generated":{"line":2,"column":31}},{"source":"node_modules/datastore-core/src/sharding.js","name":"Key","original":{"line":3,"column":6},"generated":{"line":2,"column":37}},{"source":"node_modules/datastore-core/src/sharding.js","name":"require","original":{"line":3,"column":12},"generated":{"line":2,"column":39}},{"source":"node_modules/datastore-core/src/sharding.js","original":{"line":3,"column":20},"generated":{"line":2,"column":47}},{"source":"node_modules/datastore-core/src/sharding.js","name":"Key","original":{"line":3,"column":43},"generated":{"line":2,"column":70}},{"source":"node_modules/datastore-core/src/sharding.js","name":"sh","original":{"line":5,"column":6},"generated":{"line":2,"column":74}},{"source":"node_modules/datastore-core/src/sharding.js","name":"require","original":{"line":5,"column":11},"generated":{"line":2,"column":76}},{"source":"node_modules/datastore-core/src/sharding.js","original":{"line":5,"column":19},"generated":{"line":2,"column":84}},{"source":"node_modules/datastore-core/src/sharding.js","name":"KeytransformStore","original":{"line":6,"column":6},"generated":{"line":2,"column":95}},{"source":"node_modules/datastore-core/src/sharding.js","name":"require","original":{"line":6,"column":26},"generated":{"line":2,"column":97}},{"source":"node_modules/datastore-core/src/sharding.js","original":{"line":6,"column":34},"generated":{"line":2,"column":105}},{"source":"node_modules/datastore-core/src/sharding.js","name":"shardKey","original":{"line":8,"column":6},"generated":{"line":2,"column":123}},{"source":"node_modules/datastore-core/src/sharding.js","original":{"line":8,"column":17},"generated":{"line":2,"column":125}},{"source":"node_modules/datastore-core/src/sharding.js","name":"Key","original":{"line":8,"column":21},"generated":{"line":2,"column":129}},{"source":"node_modules/datastore-core/src/sharding.js","name":"sh","original":{"line":8,"column":25},"generated":{"line":2,"column":131}},{"source":"node_modules/datastore-core/src/sharding.js","name":"SHARDING_FN","original":{"line":8,"column":28},"generated":{"line":2,"column":133}},{"source":"node_modules/datastore-core/src/sharding.js","name":"shardReadmeKey","original":{"line":9,"column":6},"generated":{"line":2,"column":146}},{"source":"node_modules/datastore-core/src/sharding.js","original":{"line":9,"column":23},"generated":{"line":2,"column":148}},{"source":"node_modules/datastore-core/src/sharding.js","name":"Key","original":{"line":9,"column":27},"generated":{"line":2,"column":152}},{"source":"node_modules/datastore-core/src/sharding.js","name":"sh","original":{"line":9,"column":31},"generated":{"line":2,"column":154}},{"source":"node_modules/datastore-core/src/sharding.js","name":"README_FN","original":{"line":9,"column":34},"generated":{"line":2,"column":156}},{"source":"node_modules/datastore-core/src/sharding.js","original":{"line":17,"column":0},"generated":{"line":2,"column":167}},{"source":"node_modules/datastore-core/src/sharding.js","name":"ShardingDatastore","original":{"line":17,"column":6},"generated":{"line":2,"column":173}},{"source":"node_modules/datastore-core/src/sharding.js","name":"constructor","original":{"line":18,"column":2},"generated":{"line":2,"column":175}},{"source":"node_modules/datastore-core/src/sharding.js","name":"store","original":{"line":18,"column":15},"generated":{"line":2,"column":187}},{"source":"node_modules/datastore-core/src/sharding.js","name":"shard","original":{"line":18,"column":22},"generated":{"line":2,"column":189}},{"source":"node_modules/datastore-core/src/sharding.js","name":"child","original":{"line":19,"column":9},"generated":{"line":2,"column":192}},{"source":"node_modules/datastore-core/src/sharding.js","name":"child","original":{"line":19,"column":9},"generated":{"line":2,"column":197}},{"source":"node_modules/datastore-core/src/sharding.js","original":{"line":19,"column":17},"generated":{"line":2,"column":203}},{"source":"node_modules/datastore-core/src/sharding.js","name":"KeytransformStore","original":{"line":19,"column":21},"generated":{"line":2,"column":207}},{"source":"node_modules/datastore-core/src/sharding.js","name":"store","original":{"line":19,"column":39},"generated":{"line":2,"column":209}},{"source":"node_modules/datastore-core/src/sharding.js","original":{"line":19,"column":46},"generated":{"line":2,"column":211}},{"source":"node_modules/datastore-core/src/sharding.js","name":"convert","original":{"line":20,"column":6},"generated":{"line":2,"column":212}},{"source":"node_modules/datastore-core/src/sharding.js","original":{"line":20,"column":15},"generated":{"line":2,"column":220}},{"source":"node_modules/datastore-core/src/sharding.js","name":"_convertKey","original":{"line":20,"column":20},"generated":{"line":2,"column":225}},{"source":"node_modules/datastore-core/src/sharding.js","name":"bind","original":{"line":20,"column":32},"generated":{"line":2,"column":237}},{"source":"node_modules/datastore-core/src/sharding.js","original":{"line":20,"column":37},"generated":{"line":2,"column":242}},{"source":"node_modules/datastore-core/src/sharding.js","name":"invert","original":{"line":21,"column":6},"generated":{"line":2,"column":248}},{"source":"node_modules/datastore-core/src/sharding.js","original":{"line":21,"column":14},"generated":{"line":2,"column":255}},{"source":"node_modules/datastore-core/src/sharding.js","name":"_invertKey","original":{"line":21,"column":19},"generated":{"line":2,"column":260}},{"source":"node_modules/datastore-core/src/sharding.js","name":"bind","original":{"line":21,"column":30},"generated":{"line":2,"column":271}},{"source":"node_modules/datastore-core/src/sharding.js","original":{"line":21,"column":35},"generated":{"line":2,"column":276}},{"source":"node_modules/datastore-core/src/sharding.js","name":"shard","original":{"line":23,"column":9},"generated":{"line":2,"column":284}},{"source":"node_modules/datastore-core/src/sharding.js","name":"shard","original":{"line":23,"column":9},"generated":{"line":2,"column":289}},{"source":"node_modules/datastore-core/src/sharding.js","name":"shard","original":{"line":23,"column":17},"generated":{"line":2,"column":295}},{"source":"node_modules/datastore-core/src/sharding.js","name":"open","original":{"line":26,"column":2},"generated":{"line":2,"column":297}},{"source":"node_modules/datastore-core/src/sharding.js","original":{"line":27,"column":11},"generated":{"line":2,"column":304}},{"source":"node_modules/datastore-core/src/sharding.js","original":{"line":27,"column":11},"generated":{"line":2,"column":311}},{"source":"node_modules/datastore-core/src/sharding.js","name":"child","original":{"line":27,"column":16},"generated":{"line":2,"column":316}},{"source":"node_modules/datastore-core/src/sharding.js","name":"open","original":{"line":27,"column":22},"generated":{"line":2,"column":322}},{"source":"node_modules/datastore-core/src/sharding.js","name":"_convertKey","original":{"line":30,"column":2},"generated":{"line":2,"column":329}},{"source":"node_modules/datastore-core/src/sharding.js","name":"key","original":{"line":30,"column":15},"generated":{"line":2,"column":341}},{"source":"node_modules/datastore-core/src/sharding.js","name":"s","original":{"line":31,"column":10},"generated":{"line":2,"column":344}},{"source":"node_modules/datastore-core/src/sharding.js","name":"s","original":{"line":31,"column":10},"generated":{"line":2,"column":350}},{"source":"node_modules/datastore-core/src/sharding.js","name":"key","original":{"line":31,"column":14},"generated":{"line":2,"column":352}},{"source":"node_modules/datastore-core/src/sharding.js","name":"toString","original":{"line":31,"column":18},"generated":{"line":2,"column":354}},{"source":"node_modules/datastore-core/src/sharding.js","name":"s","original":{"line":32,"column":8},"generated":{"line":2,"column":365}},{"source":"node_modules/datastore-core/src/sharding.js","name":"s","original":{"line":32,"column":8},"generated":{"line":2,"column":372}},{"source":"node_modules/datastore-core/src/sharding.js","name":"shardKey","original":{"line":32,"column":14},"generated":{"line":2,"column":376}},{"source":"node_modules/datastore-core/src/sharding.js","name":"toString","original":{"line":32,"column":23},"generated":{"line":2,"column":378}},{"source":"node_modules/datastore-core/src/sharding.js","name":"s","original":{"line":32,"column":37},"generated":{"line":2,"column":390}},{"source":"node_modules/datastore-core/src/sharding.js","name":"shardReadmeKey","original":{"line":32,"column":43},"generated":{"line":2,"column":394}},{"source":"node_modules/datastore-core/src/sharding.js","name":"toString","original":{"line":32,"column":58},"generated":{"line":2,"column":396}},{"source":"node_modules/datastore-core/src/sharding.js","name":"key","original":{"line":33,"column":13},"generated":{"line":2,"column":407}},{"source":"node_modules/datastore-core/src/sharding.js","original":{"line":36,"column":19},"generated":{"line":2,"column":409}},{"source":"node_modules/datastore-core/src/sharding.js","name":"Key","original":{"line":36,"column":23},"generated":{"line":2,"column":413}},{"source":"node_modules/datastore-core/src/sharding.js","original":{"line":36,"column":27},"generated":{"line":2,"column":415}},{"source":"node_modules/datastore-core/src/sharding.js","name":"shard","original":{"line":36,"column":32},"generated":{"line":2,"column":420}},{"source":"node_modules/datastore-core/src/sharding.js","name":"fun","original":{"line":36,"column":38},"generated":{"line":2,"column":426}},{"source":"node_modules/datastore-core/src/sharding.js","name":"s","original":{"line":36,"column":42},"generated":{"line":2,"column":430}},{"source":"node_modules/datastore-core/src/sharding.js","name":"child","original":{"line":37,"column":18},"generated":{"line":2,"column":434}},{"source":"node_modules/datastore-core/src/sharding.js","name":"key","original":{"line":37,"column":24},"generated":{"line":2,"column":440}},{"source":"node_modules/datastore-core/src/sharding.js","name":"_invertKey","original":{"line":40,"column":2},"generated":{"line":2,"column":443}},{"source":"node_modules/datastore-core/src/sharding.js","name":"key","original":{"line":40,"column":14},"generated":{"line":2,"column":454}},{"source":"node_modules/datastore-core/src/sharding.js","name":"s","original":{"line":41,"column":10},"generated":{"line":2,"column":457}},{"source":"node_modules/datastore-core/src/sharding.js","name":"s","original":{"line":41,"column":10},"generated":{"line":2,"column":463}},{"source":"node_modules/datastore-core/src/sharding.js","name":"key","original":{"line":41,"column":14},"generated":{"line":2,"column":465}},{"source":"node_modules/datastore-core/src/sharding.js","name":"toString","original":{"line":41,"column":18},"generated":{"line":2,"column":467}},{"source":"node_modules/datastore-core/src/sharding.js","name":"s","original":{"line":42,"column":8},"generated":{"line":2,"column":478}},{"source":"node_modules/datastore-core/src/sharding.js","name":"s","original":{"line":42,"column":8},"generated":{"line":2,"column":485}},{"source":"node_modules/datastore-core/src/sharding.js","name":"shardKey","original":{"line":42,"column":14},"generated":{"line":2,"column":489}},{"source":"node_modules/datastore-core/src/sharding.js","name":"toString","original":{"line":42,"column":23},"generated":{"line":2,"column":491}},{"source":"node_modules/datastore-core/src/sharding.js","name":"s","original":{"line":42,"column":37},"generated":{"line":2,"column":503}},{"source":"node_modules/datastore-core/src/sharding.js","name":"shardReadmeKey","original":{"line":42,"column":43},"generated":{"line":2,"column":507}},{"source":"node_modules/datastore-core/src/sharding.js","name":"toString","original":{"line":42,"column":58},"generated":{"line":2,"column":509}},{"source":"node_modules/datastore-core/src/sharding.js","name":"key","original":{"line":43,"column":13},"generated":{"line":2,"column":520}},{"source":"node_modules/datastore-core/src/sharding.js","name":"Key","original":{"line":45,"column":11},"generated":{"line":2,"column":522}},{"source":"node_modules/datastore-core/src/sharding.js","name":"withNamespaces","original":{"line":45,"column":15},"generated":{"line":2,"column":524}},{"source":"node_modules/datastore-core/src/sharding.js","name":"key","original":{"line":45,"column":30},"generated":{"line":2,"column":539}},{"source":"node_modules/datastore-core/src/sharding.js","name":"list","original":{"line":45,"column":34},"generated":{"line":2,"column":541}},{"source":"node_modules/datastore-core/src/sharding.js","name":"slice","original":{"line":45,"column":41},"generated":{"line":2,"column":548}},{"source":"node_modules/datastore-core/src/sharding.js","original":{"line":45,"column":47},"generated":{"line":2,"column":554}},{"source":"node_modules/datastore-core/src/sharding.js","name":"createOrOpen","original":{"line":48,"column":15},"generated":{"line":2,"column":558}},{"source":"node_modules/datastore-core/src/sharding.js","name":"store","original":{"line":48,"column":29},"generated":{"line":2,"column":584}},{"source":"node_modules/datastore-core/src/sharding.js","name":"shard","original":{"line":48,"column":36},"generated":{"line":2,"column":586}},{"source":"node_modules/datastore-core/src/sharding.js","original":{"line":49,"column":8},"generated":{"line":2,"column":589}},{"source":"node_modules/datastore-core/src/sharding.js","name":"ShardingDatastore","original":{"line":50,"column":12},"generated":{"line":2,"column":599}},{"source":"node_modules/datastore-core/src/sharding.js","name":"create","original":{"line":50,"column":30},"generated":{"line":2,"column":601}},{"source":"node_modules/datastore-core/src/sharding.js","name":"store","original":{"line":50,"column":37},"generated":{"line":2,"column":608}},{"source":"node_modules/datastore-core/src/sharding.js","name":"shard","original":{"line":50,"column":44},"generated":{"line":2,"column":610}},{"source":"node_modules/datastore-core/src/sharding.js","original":{"line":51,"column":6},"generated":{"line":2,"column":613}},{"source":"node_modules/datastore-core/src/sharding.js","name":"err","original":{"line":51,"column":13},"generated":{"line":2,"column":619}},{"source":"node_modules/datastore-core/src/sharding.js","name":"err","original":{"line":52,"column":10},"generated":{"line":2,"column":622}},{"source":"node_modules/datastore-core/src/sharding.js","name":"err","original":{"line":52,"column":10},"generated":{"line":2,"column":625}},{"source":"node_modules/datastore-core/src/sharding.js","original":{"line":52,"column":33},"generated":{"line":2,"column":628}},{"source":"node_modules/datastore-core/src/sharding.js","name":"err","original":{"line":52,"column":17},"generated":{"line":2,"column":649}},{"source":"node_modules/datastore-core/src/sharding.js","name":"message","original":{"line":52,"column":21},"generated":{"line":2,"column":651}},{"source":"node_modules/datastore-core/src/sharding.js","original":{"line":52,"column":53},"generated":{"line":2,"column":659}},{"source":"node_modules/datastore-core/src/sharding.js","name":"err","original":{"line":52,"column":59},"generated":{"line":2,"column":665}},{"source":"node_modules/datastore-core/src/sharding.js","name":"ShardingDatastore","original":{"line":54,"column":11},"generated":{"line":2,"column":667}},{"source":"node_modules/datastore-core/src/sharding.js","name":"ShardingDatastore","original":{"line":54,"column":11},"generated":{"line":2,"column":674}},{"source":"node_modules/datastore-core/src/sharding.js","name":"open","original":{"line":54,"column":29},"generated":{"line":2,"column":676}},{"source":"node_modules/datastore-core/src/sharding.js","name":"store","original":{"line":54,"column":34},"generated":{"line":2,"column":681}},{"source":"node_modules/datastore-core/src/sharding.js","name":"open","original":{"line":57,"column":15},"generated":{"line":2,"column":684}},{"source":"node_modules/datastore-core/src/sharding.js","name":"store","original":{"line":57,"column":21},"generated":{"line":2,"column":702}},{"source":"node_modules/datastore-core/src/sharding.js","name":"shard","original":{"line":58,"column":10},"generated":{"line":2,"column":705}},{"source":"node_modules/datastore-core/src/sharding.js","name":"shard","original":{"line":58,"column":10},"generated":{"line":2,"column":711}},{"source":"node_modules/datastore-core/src/sharding.js","name":"sh","original":{"line":58,"column":24},"generated":{"line":2,"column":719}},{"source":"node_modules/datastore-core/src/sharding.js","name":"readShardFun","original":{"line":58,"column":27},"generated":{"line":2,"column":721}},{"source":"node_modules/datastore-core/src/sharding.js","original":{"line":58,"column":40},"generated":{"line":2,"column":734}},{"source":"node_modules/datastore-core/src/sharding.js","name":"store","original":{"line":58,"column":45},"generated":{"line":2,"column":738}},{"source":"node_modules/datastore-core/src/sharding.js","original":{"line":59,"column":11},"generated":{"line":2,"column":741}},{"source":"node_modules/datastore-core/src/sharding.js","original":{"line":59,"column":11},"generated":{"line":2,"column":748}},{"source":"node_modules/datastore-core/src/sharding.js","name":"ShardingDatastore","original":{"line":59,"column":15},"generated":{"line":2,"column":752}},{"source":"node_modules/datastore-core/src/sharding.js","name":"store","original":{"line":59,"column":33},"generated":{"line":2,"column":754}},{"source":"node_modules/datastore-core/src/sharding.js","name":"shard","original":{"line":59,"column":40},"generated":{"line":2,"column":756}},{"source":"node_modules/datastore-core/src/sharding.js","name":"create","original":{"line":62,"column":15},"generated":{"line":2,"column":759}},{"source":"node_modules/datastore-core/src/sharding.js","name":"store","original":{"line":62,"column":23},"generated":{"line":2,"column":779}},{"source":"node_modules/datastore-core/src/sharding.js","name":"shard","original":{"line":62,"column":30},"generated":{"line":2,"column":781}},{"source":"node_modules/datastore-core/src/sharding.js","original":{"line":64,"column":8},"generated":{"line":2,"column":784}},{"source":"node_modules/datastore-core/src/sharding.js","name":"store","original":{"line":63,"column":25},"generated":{"line":2,"column":795}},{"source":"node_modules/datastore-core/src/sharding.js","name":"has","original":{"line":63,"column":31},"generated":{"line":2,"column":797}},{"source":"node_modules/datastore-core/src/sharding.js","name":"shardKey","original":{"line":63,"column":35},"generated":{"line":2,"column":801}},{"source":"node_modules/datastore-core/src/sharding.js","original":{"line":64,"column":17},"generated":{"line":2,"column":805}},{"source":"node_modules/datastore-core/src/sharding.js","name":"put","original":{"line":65,"column":12},"generated":{"line":2,"column":806}},{"source":"node_modules/datastore-core/src/sharding.js","name":"put","original":{"line":65,"column":12},"generated":{"line":2,"column":812}},{"source":"node_modules/datastore-core/src/sharding.js","original":{"line":65,"column":42},"generated":{"line":2,"column":814}},{"source":"node_modules/datastore-core/src/sharding.js","name":"store","original":{"line":65,"column":25},"generated":{"line":2,"column":833}},{"source":"node_modules/datastore-core/src/sharding.js","name":"putRaw","original":{"line":65,"column":31},"generated":{"line":2,"column":835}},{"source":"node_modules/datastore-core/src/sharding.js","name":"store","original":{"line":65,"column":55},"generated":{"line":2,"column":842}},{"source":"node_modules/datastore-core/src/sharding.js","name":"putRaw","original":{"line":65,"column":61},"generated":{"line":2,"column":844}},{"source":"node_modules/datastore-core/src/sharding.js","name":"bind","original":{"line":65,"column":68},"generated":{"line":2,"column":851}},{"source":"node_modules/datastore-core/src/sharding.js","name":"store","original":{"line":65,"column":73},"generated":{"line":2,"column":856}},{"source":"node_modules/datastore-core/src/sharding.js","name":"store","original":{"line":65,"column":82},"generated":{"line":2,"column":859}},{"source":"node_modules/datastore-core/src/sharding.js","name":"put","original":{"line":65,"column":88},"generated":{"line":2,"column":861}},{"source":"node_modules/datastore-core/src/sharding.js","name":"bind","original":{"line":65,"column":92},"generated":{"line":2,"column":865}},{"source":"node_modules/datastore-core/src/sharding.js","name":"store","original":{"line":65,"column":97},"generated":{"line":2,"column":870}},{"source":"node_modules/datastore-core/src/sharding.js","name":"Promise","original":{"line":66,"column":13},"generated":{"line":2,"column":873}},{"source":"node_modules/datastore-core/src/sharding.js","name":"Promise","original":{"line":66,"column":13},"generated":{"line":2,"column":880}},{"source":"node_modules/datastore-core/src/sharding.js","name":"all","original":{"line":66,"column":21},"generated":{"line":2,"column":888}},{"source":"node_modules/datastore-core/src/sharding.js","original":{"line":66,"column":25},"generated":{"line":2,"column":892}},{"source":"node_modules/datastore-core/src/sharding.js","name":"put","original":{"line":66,"column":26},"generated":{"line":2,"column":893}},{"source":"node_modules/datastore-core/src/sharding.js","name":"shardKey","original":{"line":66,"column":30},"generated":{"line":2,"column":895}},{"source":"node_modules/datastore-core/src/sharding.js","name":"Buffer","original":{"line":66,"column":40},"generated":{"line":2,"column":897}},{"source":"node_modules/datastore-core/src/sharding.js","name":"from","original":{"line":66,"column":47},"generated":{"line":2,"column":899}},{"source":"node_modules/datastore-core/src/sharding.js","name":"shard","original":{"line":66,"column":52},"generated":{"line":2,"column":904}},{"source":"node_modules/datastore-core/src/sharding.js","name":"toString","original":{"line":66,"column":58},"generated":{"line":2,"column":906}},{"source":"node_modules/datastore-core/src/sharding.js","original":{"line":66,"column":71},"generated":{"line":2,"column":917}},{"source":"node_modules/datastore-core/src/sharding.js","name":"put","original":{"line":67,"column":8},"generated":{"line":2,"column":924}},{"source":"node_modules/datastore-core/src/sharding.js","name":"shardReadmeKey","original":{"line":67,"column":12},"generated":{"line":2,"column":926}},{"source":"node_modules/datastore-core/src/sharding.js","name":"Buffer","original":{"line":67,"column":28},"generated":{"line":2,"column":928}},{"source":"node_modules/datastore-core/src/sharding.js","name":"from","original":{"line":67,"column":35},"generated":{"line":2,"column":930}},{"source":"node_modules/datastore-core/src/sharding.js","name":"sh","original":{"line":67,"column":40},"generated":{"line":2,"column":935}},{"source":"node_modules/datastore-core/src/sharding.js","name":"readme","original":{"line":67,"column":43},"generated":{"line":2,"column":937}},{"source":"node_modules/datastore-core/src/sharding.js","name":"diskShard","original":{"line":70,"column":10},"generated":{"line":2,"column":948}},{"source":"node_modules/datastore-core/src/sharding.js","name":"a","original":{"line":71,"column":10},"generated":{"line":2,"column":954}},{"source":"node_modules/datastore-core/src/sharding.js","name":"sh","original":{"line":70,"column":28},"generated":{"line":2,"column":963}},{"source":"node_modules/datastore-core/src/sharding.js","name":"readShardFun","original":{"line":70,"column":31},"generated":{"line":2,"column":965}},{"source":"node_modules/datastore-core/src/sharding.js","original":{"line":70,"column":44},"generated":{"line":2,"column":978}},{"source":"node_modules/datastore-core/src/sharding.js","name":"store","original":{"line":70,"column":49},"generated":{"line":2,"column":982}},{"source":"node_modules/datastore-core/src/sharding.js","original":{"line":71,"column":28},"generated":{"line":2,"column":986}},{"source":"node_modules/datastore-core/src/sharding.js","name":"toString","original":{"line":71,"column":32},"generated":{"line":2,"column":990}},{"source":"node_modules/datastore-core/src/sharding.js","name":"b","original":{"line":72,"column":10},"generated":{"line":2,"column":1001}},{"source":"node_modules/datastore-core/src/sharding.js","name":"shard","original":{"line":72,"column":14},"generated":{"line":2,"column":1003}},{"source":"node_modules/datastore-core/src/sharding.js","name":"toString","original":{"line":72,"column":20},"generated":{"line":2,"column":1005}},{"source":"node_modules/datastore-core/src/sharding.js","name":"a","original":{"line":73,"column":8},"generated":{"line":2,"column":1016}},{"source":"node_modules/datastore-core/src/sharding.js","name":"a","original":{"line":73,"column":8},"generated":{"line":2,"column":1019}},{"source":"node_modules/datastore-core/src/sharding.js","name":"b","original":{"line":73,"column":14},"generated":{"line":2,"column":1023}},{"source":"node_modules/datastore-core/src/sharding.js","original":{"line":73,"column":17},"generated":{"line":2,"column":1025}},{"source":"node_modules/datastore-core/src/sharding.js","original":{"line":73,"column":23},"generated":{"line":2,"column":1031}},{"source":"node_modules/datastore-core/src/sharding.js","name":"Error","original":{"line":73,"column":27},"generated":{"line":2,"column":1035}},{"source":"node_modules/datastore-core/src/sharding.js","name":"b","original":{"line":73,"column":50},"generated":{"line":2,"column":1058}},{"source":"node_modules/datastore-core/src/sharding.js","name":"a","original":{"line":73,"column":85},"generated":{"line":2,"column":1093}},{"source":"node_modules/datastore-core/src/sharding.js","original":{"line":74,"column":10},"generated":{"line":2,"column":1098}},{"source":"node_modules/datastore-core/src/sharding.js","original":{"line":74,"column":10},"generated":{"line":2,"column":1104}},{"source":"node_modules/datastore-core/src/sharding.js","name":"Error","original":{"line":74,"column":14},"generated":{"line":2,"column":1108}},{"source":"node_modules/datastore-core/src/sharding.js","original":{"line":74,"column":20},"generated":{"line":2,"column":1114}},{"source":"node_modules/datastore-core/src/sharding.js","name":"put","original":{"line":77,"column":2},"generated":{"line":2,"column":1134}},{"source":"node_modules/datastore-core/src/sharding.js","name":"key","original":{"line":77,"column":7},"generated":{"line":2,"column":1138}},{"source":"node_modules/datastore-core/src/sharding.js","name":"val","original":{"line":77,"column":12},"generated":{"line":2,"column":1140}},{"source":"node_modules/datastore-core/src/sharding.js","original":{"line":78,"column":11},"generated":{"line":2,"column":1143}},{"source":"node_modules/datastore-core/src/sharding.js","original":{"line":78,"column":11},"generated":{"line":2,"column":1150}},{"source":"node_modules/datastore-core/src/sharding.js","name":"child","original":{"line":78,"column":16},"generated":{"line":2,"column":1155}},{"source":"node_modules/datastore-core/src/sharding.js","name":"put","original":{"line":78,"column":22},"generated":{"line":2,"column":1161}},{"source":"node_modules/datastore-core/src/sharding.js","name":"key","original":{"line":78,"column":26},"generated":{"line":2,"column":1165}},{"source":"node_modules/datastore-core/src/sharding.js","name":"val","original":{"line":78,"column":31},"generated":{"line":2,"column":1167}},{"source":"node_modules/datastore-core/src/sharding.js","name":"get","original":{"line":81,"column":2},"generated":{"line":2,"column":1170}},{"source":"node_modules/datastore-core/src/sharding.js","name":"key","original":{"line":81,"column":7},"generated":{"line":2,"column":1174}},{"source":"node_modules/datastore-core/src/sharding.js","original":{"line":82,"column":11},"generated":{"line":2,"column":1177}},{"source":"node_modules/datastore-core/src/sharding.js","original":{"line":82,"column":11},"generated":{"line":2,"column":1184}},{"source":"node_modules/datastore-core/src/sharding.js","name":"child","original":{"line":82,"column":16},"generated":{"line":2,"column":1189}},{"source":"node_modules/datastore-core/src/sharding.js","name":"get","original":{"line":82,"column":22},"generated":{"line":2,"column":1195}},{"source":"node_modules/datastore-core/src/sharding.js","name":"key","original":{"line":82,"column":26},"generated":{"line":2,"column":1199}},{"source":"node_modules/datastore-core/src/sharding.js","name":"has","original":{"line":85,"column":2},"generated":{"line":2,"column":1202}},{"source":"node_modules/datastore-core/src/sharding.js","name":"key","original":{"line":85,"column":7},"generated":{"line":2,"column":1206}},{"source":"node_modules/datastore-core/src/sharding.js","original":{"line":86,"column":11},"generated":{"line":2,"column":1209}},{"source":"node_modules/datastore-core/src/sharding.js","original":{"line":86,"column":11},"generated":{"line":2,"column":1216}},{"source":"node_modules/datastore-core/src/sharding.js","name":"child","original":{"line":86,"column":16},"generated":{"line":2,"column":1221}},{"source":"node_modules/datastore-core/src/sharding.js","name":"has","original":{"line":86,"column":22},"generated":{"line":2,"column":1227}},{"source":"node_modules/datastore-core/src/sharding.js","name":"key","original":{"line":86,"column":26},"generated":{"line":2,"column":1231}},{"source":"node_modules/datastore-core/src/sharding.js","name":"delete","original":{"line":89,"column":2},"generated":{"line":2,"column":1234}},{"source":"node_modules/datastore-core/src/sharding.js","name":"key","original":{"line":89,"column":10},"generated":{"line":2,"column":1241}},{"source":"node_modules/datastore-core/src/sharding.js","original":{"line":90,"column":11},"generated":{"line":2,"column":1244}},{"source":"node_modules/datastore-core/src/sharding.js","original":{"line":90,"column":11},"generated":{"line":2,"column":1251}},{"source":"node_modules/datastore-core/src/sharding.js","name":"child","original":{"line":90,"column":16},"generated":{"line":2,"column":1256}},{"source":"node_modules/datastore-core/src/sharding.js","name":"delete","original":{"line":90,"column":22},"generated":{"line":2,"column":1262}},{"source":"node_modules/datastore-core/src/sharding.js","name":"key","original":{"line":90,"column":29},"generated":{"line":2,"column":1269}},{"source":"node_modules/datastore-core/src/sharding.js","name":"batch","original":{"line":93,"column":2},"generated":{"line":2,"column":1272}},{"source":"node_modules/datastore-core/src/sharding.js","original":{"line":94,"column":11},"generated":{"line":2,"column":1280}},{"source":"node_modules/datastore-core/src/sharding.js","original":{"line":94,"column":11},"generated":{"line":2,"column":1287}},{"source":"node_modules/datastore-core/src/sharding.js","name":"child","original":{"line":94,"column":16},"generated":{"line":2,"column":1292}},{"source":"node_modules/datastore-core/src/sharding.js","name":"batch","original":{"line":94,"column":22},"generated":{"line":2,"column":1298}},{"source":"node_modules/datastore-core/src/sharding.js","name":"query","original":{"line":97,"column":2},"generated":{"line":2,"column":1306}},{"source":"node_modules/datastore-core/src/sharding.js","name":"q","original":{"line":97,"column":9},"generated":{"line":2,"column":1312}},{"source":"node_modules/datastore-core/src/sharding.js","name":"tq","original":{"line":98,"column":10},"generated":{"line":2,"column":1315}},{"source":"node_modules/datastore-core/src/sharding.js","name":"tq","original":{"line":98,"column":10},"generated":{"line":2,"column":1321}},{"source":"node_modules/datastore-core/src/sharding.js","original":{"line":98,"column":15},"generated":{"line":2,"column":1323}},{"source":"node_modules/datastore-core/src/sharding.js","name":"keysOnly","original":{"line":99,"column":6},"generated":{"line":2,"column":1324}},{"source":"node_modules/datastore-core/src/sharding.js","name":"q","original":{"line":99,"column":16},"generated":{"line":2,"column":1333}},{"source":"node_modules/datastore-core/src/sharding.js","name":"keysOnly","original":{"line":99,"column":18},"generated":{"line":2,"column":1335}},{"source":"node_modules/datastore-core/src/sharding.js","name":"offset","original":{"line":100,"column":6},"generated":{"line":2,"column":1344}},{"source":"node_modules/datastore-core/src/sharding.js","name":"q","original":{"line":100,"column":14},"generated":{"line":2,"column":1351}},{"source":"node_modules/datastore-core/src/sharding.js","name":"offset","original":{"line":100,"column":16},"generated":{"line":2,"column":1353}},{"source":"node_modules/datastore-core/src/sharding.js","name":"limit","original":{"line":101,"column":6},"generated":{"line":2,"column":1360}},{"source":"node_modules/datastore-core/src/sharding.js","name":"q","original":{"line":101,"column":13},"generated":{"line":2,"column":1366}},{"source":"node_modules/datastore-core/src/sharding.js","name":"limit","original":{"line":101,"column":15},"generated":{"line":2,"column":1368}},{"source":"node_modules/datastore-core/src/sharding.js","name":"filters","original":{"line":102,"column":6},"generated":{"line":2,"column":1374}},{"source":"node_modules/datastore-core/src/sharding.js","original":{"line":102,"column":15},"generated":{"line":2,"column":1382}},{"source":"node_modules/datastore-core/src/sharding.js","name":"e","original":{"line":103,"column":8},"generated":{"line":2,"column":1383}},{"source":"node_modules/datastore-core/src/sharding.js","name":"e","original":{"line":103,"column":13},"generated":{"line":2,"column":1386}},{"source":"node_modules/datastore-core/src/sharding.js","name":"key","original":{"line":103,"column":15},"generated":{"line":2,"column":1388}},{"source":"node_modules/datastore-core/src/sharding.js","name":"toString","original":{"line":103,"column":19},"generated":{"line":2,"column":1392}},{"source":"node_modules/datastore-core/src/sharding.js","name":"shardKey","original":{"line":103,"column":34},"generated":{"line":2,"column":1405}},{"source":"node_modules/datastore-core/src/sharding.js","name":"toString","original":{"line":103,"column":43},"generated":{"line":2,"column":1407}},{"source":"node_modules/datastore-core/src/sharding.js","name":"e","original":{"line":104,"column":8},"generated":{"line":2,"column":1418}},{"source":"node_modules/datastore-core/src/sharding.js","name":"e","original":{"line":104,"column":13},"generated":{"line":2,"column":1421}},{"source":"node_modules/datastore-core/src/sharding.js","name":"key","original":{"line":104,"column":15},"generated":{"line":2,"column":1423}},{"source":"node_modules/datastore-core/src/sharding.js","name":"toString","original":{"line":104,"column":19},"generated":{"line":2,"column":1427}},{"source":"node_modules/datastore-core/src/sharding.js","name":"shardReadmeKey","original":{"line":104,"column":34},"generated":{"line":2,"column":1440}},{"source":"node_modules/datastore-core/src/sharding.js","name":"toString","original":{"line":104,"column":49},"generated":{"line":2,"column":1442}},{"source":"node_modules/datastore-core/src/sharding.js","name":"q","original":{"line":114,"column":8},"generated":{"line":2,"column":1455}},{"source":"node_modules/datastore-core/src/sharding.js","original":{"line":108,"column":20},"generated":{"line":2,"column":1458}},{"source":"node_modules/datastore-core/src/sharding.js","name":"q","original":{"line":108,"column":8},"generated":{"line":2,"column":1464}},{"source":"node_modules/datastore-core/src/sharding.js","name":"prefix","original":{"line":108,"column":10},"generated":{"line":2,"column":1466}},{"source":"node_modules/datastore-core/src/sharding.js","name":"tq","original":{"line":109,"column":6},"generated":{"line":2,"column":1474}},{"source":"node_modules/datastore-core/src/sharding.js","name":"filters","original":{"line":109,"column":9},"generated":{"line":2,"column":1476}},{"source":"node_modules/datastore-core/src/sharding.js","name":"push","original":{"line":109,"column":17},"generated":{"line":2,"column":1484}},{"source":"node_modules/datastore-core/src/sharding.js","name":"e","original":{"line":109,"column":23},"generated":{"line":2,"column":1489}},{"source":"node_modules/datastore-core/src/sharding.js","original":{"line":110,"column":15},"generated":{"line":2,"column":1492}},{"source":"node_modules/datastore-core/src/sharding.js","name":"_invertKey","original":{"line":110,"column":20},"generated":{"line":2,"column":1497}},{"source":"node_modules/datastore-core/src/sharding.js","name":"e","original":{"line":110,"column":31},"generated":{"line":2,"column":1508}},{"source":"node_modules/datastore-core/src/sharding.js","name":"key","original":{"line":110,"column":33},"generated":{"line":2,"column":1510}},{"source":"node_modules/datastore-core/src/sharding.js","name":"toString","original":{"line":110,"column":38},"generated":{"line":2,"column":1515}},{"source":"node_modules/datastore-core/src/sharding.js","name":"startsWith","original":{"line":110,"column":49},"generated":{"line":2,"column":1526}},{"source":"node_modules/datastore-core/src/sharding.js","name":"q","original":{"line":110,"column":60},"generated":{"line":2,"column":1537}},{"source":"node_modules/datastore-core/src/sharding.js","name":"prefix","original":{"line":110,"column":62},"generated":{"line":2,"column":1539}},{"source":"node_modules/datastore-core/src/sharding.js","original":{"line":114,"column":21},"generated":{"line":2,"column":1548}},{"source":"node_modules/datastore-core/src/sharding.js","name":"q","original":{"line":114,"column":8},"generated":{"line":2,"column":1554}},{"source":"node_modules/datastore-core/src/sharding.js","name":"filters","original":{"line":114,"column":10},"generated":{"line":2,"column":1556}},{"source":"node_modules/datastore-core/src/sharding.js","original":{"line":114,"column":27},"generated":{"line":2,"column":1564}},{"source":"node_modules/datastore-core/src/sharding.js","name":"filters","original":{"line":115,"column":12},"generated":{"line":2,"column":1565}},{"source":"node_modules/datastore-core/src/sharding.js","name":"filters","original":{"line":115,"column":12},"generated":{"line":2,"column":1571}},{"source":"node_modules/datastore-core/src/sharding.js","name":"q","original":{"line":115,"column":22},"generated":{"line":2,"column":1573}},{"source":"node_modules/datastore-core/src/sharding.js","name":"filters","original":{"line":115,"column":24},"generated":{"line":2,"column":1575}},{"source":"node_modules/datastore-core/src/sharding.js","name":"map","original":{"line":115,"column":32},"generated":{"line":2,"column":1583}},{"source":"node_modules/datastore-core/src/sharding.js","name":"f","original":{"line":115,"column":37},"generated":{"line":2,"column":1587}},{"source":"node_modules/datastore-core/src/sharding.js","name":"e","original":{"line":115,"column":44},"generated":{"line":2,"column":1590}},{"source":"node_modules/datastore-core/src/sharding.js","name":"f","original":{"line":116,"column":15},"generated":{"line":2,"column":1593}},{"source":"node_modules/datastore-core/src/sharding.js","name":"Object","original":{"line":116,"column":17},"generated":{"line":2,"column":1595}},{"source":"node_modules/datastore-core/src/sharding.js","name":"assign","original":{"line":116,"column":24},"generated":{"line":2,"column":1602}},{"source":"node_modules/datastore-core/src/sharding.js","original":{"line":116,"column":31},"generated":{"line":2,"column":1609}},{"source":"node_modules/datastore-core/src/sharding.js","name":"e","original":{"line":116,"column":35},"generated":{"line":2,"column":1612}},{"source":"node_modules/datastore-core/src/sharding.js","original":{"line":116,"column":38},"generated":{"line":2,"column":1614}},{"source":"node_modules/datastore-core/src/sharding.js","name":"key","original":{"line":117,"column":10},"generated":{"line":2,"column":1615}},{"source":"node_modules/datastore-core/src/sharding.js","original":{"line":117,"column":15},"generated":{"line":2,"column":1619}},{"source":"node_modules/datastore-core/src/sharding.js","name":"_invertKey","original":{"line":117,"column":20},"generated":{"line":2,"column":1624}},{"source":"node_modules/datastore-core/src/sharding.js","name":"e","original":{"line":117,"column":31},"generated":{"line":2,"column":1635}},{"source":"node_modules/datastore-core/src/sharding.js","name":"key","original":{"line":117,"column":33},"generated":{"line":2,"column":1637}},{"source":"node_modules/datastore-core/src/sharding.js","name":"tq","original":{"line":120,"column":6},"generated":{"line":2,"column":1646}},{"source":"node_modules/datastore-core/src/sharding.js","name":"filters","original":{"line":120,"column":9},"generated":{"line":2,"column":1648}},{"source":"node_modules/datastore-core/src/sharding.js","name":"tq","original":{"line":120,"column":19},"generated":{"line":2,"column":1656}},{"source":"node_modules/datastore-core/src/sharding.js","name":"filters","original":{"line":120,"column":22},"generated":{"line":2,"column":1658}},{"source":"node_modules/datastore-core/src/sharding.js","name":"concat","original":{"line":120,"column":30},"generated":{"line":2,"column":1666}},{"source":"node_modules/datastore-core/src/sharding.js","name":"filters","original":{"line":120,"column":37},"generated":{"line":2,"column":1673}},{"source":"node_modules/datastore-core/src/sharding.js","original":{"line":132,"column":11},"generated":{"line":2,"column":1676}},{"source":"node_modules/datastore-core/src/sharding.js","original":{"line":123,"column":20},"generated":{"line":2,"column":1683}},{"source":"node_modules/datastore-core/src/sharding.js","name":"q","original":{"line":123,"column":8},"generated":{"line":2,"column":1689}},{"source":"node_modules/datastore-core/src/sharding.js","name":"orders","original":{"line":123,"column":10},"generated":{"line":2,"column":1691}},{"source":"node_modules/datastore-core/src/sharding.js","name":"tq","original":{"line":124,"column":6},"generated":{"line":2,"column":1700}},{"source":"node_modules/datastore-core/src/sharding.js","name":"orders","original":{"line":124,"column":9},"generated":{"line":2,"column":1702}},{"source":"node_modules/datastore-core/src/sharding.js","name":"q","original":{"line":124,"column":18},"generated":{"line":2,"column":1709}},{"source":"node_modules/datastore-core/src/sharding.js","name":"orders","original":{"line":124,"column":20},"generated":{"line":2,"column":1711}},{"source":"node_modules/datastore-core/src/sharding.js","name":"map","original":{"line":124,"column":27},"generated":{"line":2,"column":1718}},{"source":"node_modules/datastore-core/src/sharding.js","name":"o","original":{"line":124,"column":32},"generated":{"line":2,"column":1722}},{"source":"node_modules/datastore-core/src/sharding.js","original":{"line":124,"column":38},"generated":{"line":2,"column":1725}},{"source":"node_modules/datastore-core/src/sharding.js","original":{"line":124,"column":38},"generated":{"line":2,"column":1731}},{"source":"node_modules/datastore-core/src/sharding.js","name":"res","original":{"line":125,"column":8},"generated":{"line":2,"column":1735}},{"source":"node_modules/datastore-core/src/sharding.js","name":"forEach","original":{"line":125,"column":12},"generated":{"line":2,"column":1737}},{"source":"node_modules/datastore-core/src/sharding.js","name":"e","original":{"line":125,"column":21},"generated":{"line":2,"column":1745}},{"source":"node_modules/datastore-core/src/sharding.js","name":"e","original":{"line":125,"column":29},"generated":{"line":2,"column":1749}},{"source":"node_modules/datastore-core/src/sharding.js","name":"key","original":{"line":125,"column":31},"generated":{"line":2,"column":1751}},{"source":"node_modules/datastore-core/src/sharding.js","original":{"line":125,"column":37},"generated":{"line":2,"column":1755}},{"source":"node_modules/datastore-core/src/sharding.js","name":"_invertKey","original":{"line":125,"column":42},"generated":{"line":2,"column":1760}},{"source":"node_modules/datastore-core/src/sharding.js","name":"e","original":{"line":125,"column":53},"generated":{"line":2,"column":1771}},{"source":"node_modules/datastore-core/src/sharding.js","name":"key","original":{"line":125,"column":55},"generated":{"line":2,"column":1773}},{"source":"node_modules/datastore-core/src/sharding.js","name":"ordered","original":{"line":126,"column":14},"generated":{"line":2,"column":1780}},{"source":"node_modules/datastore-core/src/sharding.js","name":"ordered","original":{"line":126,"column":14},"generated":{"line":2,"column":1786}},{"source":"node_modules/datastore-core/src/sharding.js","name":"o","original":{"line":126,"column":30},"generated":{"line":2,"column":1794}},{"source":"node_modules/datastore-core/src/sharding.js","name":"res","original":{"line":126,"column":32},"generated":{"line":2,"column":1796}},{"source":"node_modules/datastore-core/src/sharding.js","name":"ordered","original":{"line":128,"column":15},"generated":{"line":2,"column":1799}},{"source":"node_modules/datastore-core/src/sharding.js","name":"ordered","original":{"line":127,"column":8},"generated":{"line":2,"column":1806}},{"source":"node_modules/datastore-core/src/sharding.js","name":"forEach","original":{"line":127,"column":16},"generated":{"line":2,"column":1808}},{"source":"node_modules/datastore-core/src/sharding.js","name":"e","original":{"line":127,"column":25},"generated":{"line":2,"column":1816}},{"source":"node_modules/datastore-core/src/sharding.js","name":"e","original":{"line":127,"column":33},"generated":{"line":2,"column":1820}},{"source":"node_modules/datastore-core/src/sharding.js","name":"key","original":{"line":127,"column":35},"generated":{"line":2,"column":1822}},{"source":"node_modules/datastore-core/src/sharding.js","original":{"line":127,"column":41},"generated":{"line":2,"column":1826}},{"source":"node_modules/datastore-core/src/sharding.js","name":"_convertKey","original":{"line":127,"column":46},"generated":{"line":2,"column":1831}},{"source":"node_modules/datastore-core/src/sharding.js","name":"e","original":{"line":127,"column":58},"generated":{"line":2,"column":1843}},{"source":"node_modules/datastore-core/src/sharding.js","name":"key","original":{"line":127,"column":60},"generated":{"line":2,"column":1845}},{"source":"node_modules/datastore-core/src/sharding.js","name":"ordered","original":{"line":128,"column":15},"generated":{"line":2,"column":1852}},{"source":"node_modules/datastore-core/src/sharding.js","original":{"line":132,"column":11},"generated":{"line":2,"column":1857}},{"source":"node_modules/datastore-core/src/sharding.js","name":"child","original":{"line":132,"column":16},"generated":{"line":2,"column":1862}},{"source":"node_modules/datastore-core/src/sharding.js","name":"query","original":{"line":132,"column":22},"generated":{"line":2,"column":1868}},{"source":"node_modules/datastore-core/src/sharding.js","name":"tq","original":{"line":132,"column":28},"generated":{"line":2,"column":1874}},{"source":"node_modules/datastore-core/src/sharding.js","name":"close","original":{"line":135,"column":2},"generated":{"line":2,"column":1877}},{"source":"node_modules/datastore-core/src/sharding.js","original":{"line":136,"column":11},"generated":{"line":2,"column":1885}},{"source":"node_modules/datastore-core/src/sharding.js","original":{"line":136,"column":11},"generated":{"line":2,"column":1892}},{"source":"node_modules/datastore-core/src/sharding.js","name":"child","original":{"line":136,"column":16},"generated":{"line":2,"column":1897}},{"source":"node_modules/datastore-core/src/sharding.js","name":"close","original":{"line":136,"column":22},"generated":{"line":2,"column":1903}},{"source":"node_modules/datastore-core/src/sharding.js","name":"module","original":{"line":140,"column":0},"generated":{"line":2,"column":1912}},{"source":"node_modules/datastore-core/src/sharding.js","name":"exports","original":{"line":140,"column":7},"generated":{"line":2,"column":1919}},{"source":"node_modules/datastore-core/src/sharding.js","name":"ShardingDatastore","original":{"line":140,"column":17},"generated":{"line":2,"column":1927}}],"sources":{"node_modules/datastore-core/src/sharding.js":"'use strict'\n\nconst Key = require('interface-datastore').Key\n\nconst sh = require('./shard')\nconst KeytransformStore = require('./keytransform')\n\nconst shardKey = new Key(sh.SHARDING_FN)\nconst shardReadmeKey = new Key(sh.README_FN)\n\n/**\n * Backend independent abstraction of go-ds-flatfs.\n *\n * Wraps another datastore such that all values are stored\n * sharded according to the given sharding function.\n */\nclass ShardingDatastore {\n  constructor (store, shard) {\n    this.child = new KeytransformStore(store, {\n      convert: this._convertKey.bind(this),\n      invert: this._invertKey.bind(this)\n    })\n    this.shard = shard\n  }\n\n  open () {\n    return this.child.open()\n  }\n\n  _convertKey (key) {\n    const s = key.toString()\n    if (s === shardKey.toString() || s === shardReadmeKey.toString()) {\n      return key\n    }\n\n    const parent = new Key(this.shard.fun(s))\n    return parent.child(key)\n  }\n\n  _invertKey (key) {\n    const s = key.toString()\n    if (s === shardKey.toString() || s === shardReadmeKey.toString()) {\n      return key\n    }\n    return Key.withNamespaces(key.list().slice(1))\n  }\n\n  static async createOrOpen (store, shard) {\n    try {\n      await ShardingDatastore.create(store, shard)\n    } catch (err) {\n      if (err && err.message !== 'datastore exists') throw err\n    }\n    return ShardingDatastore.open(store)\n  }\n\n  static async open (store) {\n    const shard = await sh.readShardFun('/', store)\n    return new ShardingDatastore(store, shard)\n  }\n\n  static async create (store, shard) {\n    const exists = await store.has(shardKey)\n    if (!exists) {\n      const put = typeof store.putRaw === 'function' ? store.putRaw.bind(store) : store.put.bind(store)\n      return Promise.all([put(shardKey, Buffer.from(shard.toString() + '\\n')),\n        put(shardReadmeKey, Buffer.from(sh.readme))])\n    }\n\n    const diskShard = await sh.readShardFun('/', store)\n    const a = (diskShard || '').toString()\n    const b = shard.toString()\n    if (a !== b) throw new Error(`specified fun ${b} does not match repo shard fun ${a}`)\n    throw new Error('datastore exists')\n  }\n\n  put (key, val) {\n    return this.child.put(key, val)\n  }\n\n  get (key) {\n    return this.child.get(key)\n  }\n\n  has (key) {\n    return this.child.has(key)\n  }\n\n  delete (key) {\n    return this.child.delete(key)\n  }\n\n  batch () {\n    return this.child.batch()\n  }\n\n  query (q) {\n    const tq = {\n      keysOnly: q.keysOnly,\n      offset: q.offset,\n      limit: q.limit,\n      filters: [\n        e => e.key.toString() !== shardKey.toString(),\n        e => e.key.toString() !== shardReadmeKey.toString()\n      ]\n    }\n\n    if (q.prefix != null) {\n      tq.filters.push((e) => {\n        return this._invertKey(e.key).toString().startsWith(q.prefix)\n      })\n    }\n\n    if (q.filters != null) {\n      const filters = q.filters.map((f) => (e) => {\n        return f(Object.assign({}, e, {\n          key: this._invertKey(e.key)\n        }))\n      })\n      tq.filters = tq.filters.concat(filters)\n    }\n\n    if (q.orders != null) {\n      tq.orders = q.orders.map((o) => async (res) => {\n        res.forEach((e) => { e.key = this._invertKey(e.key) })\n        const ordered = await o(res)\n        ordered.forEach((e) => { e.key = this._convertKey(e.key) })\n        return ordered\n      })\n    }\n\n    return this.child.query(tq)\n  }\n\n  close () {\n    return this.child.close()\n  }\n}\n\nmodule.exports = ShardingDatastore\n"},"lineCount":null}},"error":null,"hash":"bfb11ebaf6c8feda293a0d86145e4dfc","cacheData":{"env":{}}}