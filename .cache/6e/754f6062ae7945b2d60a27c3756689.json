{"id":"Zd2T","dependencies":[{"name":"/Users/polluterofminds/Development/simpleid/ssa-sdk/package.json","includedInParent":true,"mtime":1584306008866},{"name":"/Users/polluterofminds/Development/simpleid/ssa-sdk/node_modules/ipfs/package.json","includedInParent":true,"mtime":1582579778668},{"name":"../../utils/tlru","loc":{"line":4,"column":21},"parent":"/Users/polluterofminds/Development/simpleid/ssa-sdk/node_modules/ipfs/src/core/runtime/dns-browser.js","resolved":"/Users/polluterofminds/Development/simpleid/ssa-sdk/node_modules/ipfs/src/utils/tlru.js"},{"name":"p-queue","loc":{"line":5,"column":36},"parent":"/Users/polluterofminds/Development/simpleid/ssa-sdk/node_modules/ipfs/src/core/runtime/dns-browser.js","resolved":"/Users/polluterofminds/Development/simpleid/ssa-sdk/node_modules/ipfs/node_modules/p-queue/dist/index.js"},{"name":"ky-universal","loc":{"line":6,"column":32},"parent":"/Users/polluterofminds/Development/simpleid/ssa-sdk/node_modules/ipfs/src/core/runtime/dns-browser.js","resolved":"/Users/polluterofminds/Development/simpleid/ssa-sdk/node_modules/ipfs/node_modules/ky-universal/browser.js"}],"generated":{"js":"\"use strict\";const e=require(\"../../utils/tlru\"),{default:r}=require(\"p-queue\"),{default:s}=require(\"ky-universal\"),t=new e(1e3),a=6e4,n=new r({concurrency:4}),c=s.create({prefixUrl:\"https://ipfs.io/api/v0/\",hooks:{afterResponse:[async(e,r,s)=>{const a=new URL(s.url).search.slice(1),n=await s.json();t.set(a,n,6e4)}]}}),o=e=>{if(e.Path)return e.Path;throw new Error(e.Message)};module.exports=(async(e,r)=>{return(async(e,r)=>{r=r||{};const s=new URLSearchParams(r);s.set(\"arg\",e);const a=s.toString();if(!r.nocache&&t.has(a)){const e=t.get(a);return o(e)}const u=await n.add(()=>c.get(\"dns\",{searchParams:s}).json());return o(u)})(e,r)});"},"sourceMaps":{"js":{"mappings":[{"source":"node_modules/ipfs/src/core/runtime/dns-browser.js","original":{"line":2,"column":0},"generated":{"line":1,"column":0}},{"source":"node_modules/ipfs/src/core/runtime/dns-browser.js","original":{"line":4,"column":0},"generated":{"line":1,"column":13}},{"source":"node_modules/ipfs/src/core/runtime/dns-browser.js","name":"TLRU","original":{"line":4,"column":6},"generated":{"line":1,"column":19}},{"source":"node_modules/ipfs/src/core/runtime/dns-browser.js","name":"require","original":{"line":4,"column":13},"generated":{"line":1,"column":21}},{"source":"node_modules/ipfs/src/core/runtime/dns-browser.js","original":{"line":4,"column":21},"generated":{"line":1,"column":29}},{"source":"node_modules/ipfs/src/core/runtime/dns-browser.js","name":"default","original":{"line":5,"column":8},"generated":{"line":1,"column":50}},{"source":"node_modules/ipfs/src/core/runtime/dns-browser.js","name":"PQueue","original":{"line":5,"column":17},"generated":{"line":1,"column":58}},{"source":"node_modules/ipfs/src/core/runtime/dns-browser.js","name":"require","original":{"line":5,"column":28},"generated":{"line":1,"column":61}},{"source":"node_modules/ipfs/src/core/runtime/dns-browser.js","original":{"line":5,"column":36},"generated":{"line":1,"column":69}},{"source":"node_modules/ipfs/src/core/runtime/dns-browser.js","name":"default","original":{"line":6,"column":8},"generated":{"line":1,"column":81}},{"source":"node_modules/ipfs/src/core/runtime/dns-browser.js","name":"ky","original":{"line":6,"column":17},"generated":{"line":1,"column":89}},{"source":"node_modules/ipfs/src/core/runtime/dns-browser.js","name":"require","original":{"line":6,"column":24},"generated":{"line":1,"column":92}},{"source":"node_modules/ipfs/src/core/runtime/dns-browser.js","original":{"line":6,"column":32},"generated":{"line":1,"column":100}},{"source":"node_modules/ipfs/src/core/runtime/dns-browser.js","name":"cache","original":{"line":9,"column":6},"generated":{"line":1,"column":116}},{"source":"node_modules/ipfs/src/core/runtime/dns-browser.js","original":{"line":9,"column":14},"generated":{"line":1,"column":118}},{"source":"node_modules/ipfs/src/core/runtime/dns-browser.js","name":"TLRU","original":{"line":9,"column":18},"generated":{"line":1,"column":122}},{"source":"node_modules/ipfs/src/core/runtime/dns-browser.js","original":{"line":9,"column":23},"generated":{"line":1,"column":124}},{"source":"node_modules/ipfs/src/core/runtime/dns-browser.js","name":"ttl","original":{"line":13,"column":6},"generated":{"line":1,"column":129}},{"source":"node_modules/ipfs/src/core/runtime/dns-browser.js","original":{"line":13,"column":12},"generated":{"line":1,"column":131}},{"source":"node_modules/ipfs/src/core/runtime/dns-browser.js","name":"httpQueue","original":{"line":17,"column":6},"generated":{"line":1,"column":135}},{"source":"node_modules/ipfs/src/core/runtime/dns-browser.js","original":{"line":17,"column":18},"generated":{"line":1,"column":137}},{"source":"node_modules/ipfs/src/core/runtime/dns-browser.js","name":"PQueue","original":{"line":17,"column":22},"generated":{"line":1,"column":141}},{"source":"node_modules/ipfs/src/core/runtime/dns-browser.js","original":{"line":17,"column":29},"generated":{"line":1,"column":143}},{"source":"node_modules/ipfs/src/core/runtime/dns-browser.js","name":"concurrency","original":{"line":17,"column":31},"generated":{"line":1,"column":144}},{"source":"node_modules/ipfs/src/core/runtime/dns-browser.js","original":{"line":17,"column":44},"generated":{"line":1,"column":156}},{"source":"node_modules/ipfs/src/core/runtime/dns-browser.js","name":"api","original":{"line":21,"column":6},"generated":{"line":1,"column":160}},{"source":"node_modules/ipfs/src/core/runtime/dns-browser.js","name":"ky","original":{"line":21,"column":12},"generated":{"line":1,"column":162}},{"source":"node_modules/ipfs/src/core/runtime/dns-browser.js","name":"create","original":{"line":21,"column":15},"generated":{"line":1,"column":164}},{"source":"node_modules/ipfs/src/core/runtime/dns-browser.js","original":{"line":21,"column":22},"generated":{"line":1,"column":171}},{"source":"node_modules/ipfs/src/core/runtime/dns-browser.js","name":"prefixUrl","original":{"line":22,"column":2},"generated":{"line":1,"column":172}},{"source":"node_modules/ipfs/src/core/runtime/dns-browser.js","original":{"line":22,"column":13},"generated":{"line":1,"column":182}},{"source":"node_modules/ipfs/src/core/runtime/dns-browser.js","name":"hooks","original":{"line":23,"column":2},"generated":{"line":1,"column":208}},{"source":"node_modules/ipfs/src/core/runtime/dns-browser.js","original":{"line":23,"column":9},"generated":{"line":1,"column":214}},{"source":"node_modules/ipfs/src/core/runtime/dns-browser.js","name":"afterResponse","original":{"line":24,"column":4},"generated":{"line":1,"column":215}},{"source":"node_modules/ipfs/src/core/runtime/dns-browser.js","original":{"line":24,"column":19},"generated":{"line":1,"column":229}},{"source":"node_modules/ipfs/src/core/runtime/dns-browser.js","original":{"line":25,"column":6},"generated":{"line":1,"column":230}},{"source":"node_modules/ipfs/src/core/runtime/dns-browser.js","name":"input","original":{"line":25,"column":13},"generated":{"line":1,"column":236}},{"source":"node_modules/ipfs/src/core/runtime/dns-browser.js","name":"options","original":{"line":25,"column":20},"generated":{"line":1,"column":238}},{"source":"node_modules/ipfs/src/core/runtime/dns-browser.js","name":"response","original":{"line":25,"column":29},"generated":{"line":1,"column":240}},{"source":"node_modules/ipfs/src/core/runtime/dns-browser.js","name":"query","original":{"line":26,"column":14},"generated":{"line":1,"column":245}},{"source":"node_modules/ipfs/src/core/runtime/dns-browser.js","name":"query","original":{"line":26,"column":14},"generated":{"line":1,"column":251}},{"source":"node_modules/ipfs/src/core/runtime/dns-browser.js","original":{"line":26,"column":22},"generated":{"line":1,"column":253}},{"source":"node_modules/ipfs/src/core/runtime/dns-browser.js","name":"URL","original":{"line":26,"column":26},"generated":{"line":1,"column":257}},{"source":"node_modules/ipfs/src/core/runtime/dns-browser.js","name":"response","original":{"line":26,"column":30},"generated":{"line":1,"column":261}},{"source":"node_modules/ipfs/src/core/runtime/dns-browser.js","name":"url","original":{"line":26,"column":39},"generated":{"line":1,"column":263}},{"source":"node_modules/ipfs/src/core/runtime/dns-browser.js","name":"search","original":{"line":26,"column":44},"generated":{"line":1,"column":268}},{"source":"node_modules/ipfs/src/core/runtime/dns-browser.js","name":"slice","original":{"line":26,"column":51},"generated":{"line":1,"column":275}},{"source":"node_modules/ipfs/src/core/runtime/dns-browser.js","original":{"line":26,"column":57},"generated":{"line":1,"column":281}},{"source":"node_modules/ipfs/src/core/runtime/dns-browser.js","name":"json","original":{"line":27,"column":14},"generated":{"line":1,"column":284}},{"source":"node_modules/ipfs/src/core/runtime/dns-browser.js","name":"response","original":{"line":27,"column":27},"generated":{"line":1,"column":292}},{"source":"node_modules/ipfs/src/core/runtime/dns-browser.js","name":"json","original":{"line":27,"column":36},"generated":{"line":1,"column":294}},{"source":"node_modules/ipfs/src/core/runtime/dns-browser.js","name":"cache","original":{"line":28,"column":8},"generated":{"line":1,"column":301}},{"source":"node_modules/ipfs/src/core/runtime/dns-browser.js","name":"set","original":{"line":28,"column":14},"generated":{"line":1,"column":303}},{"source":"node_modules/ipfs/src/core/runtime/dns-browser.js","name":"query","original":{"line":28,"column":18},"generated":{"line":1,"column":307}},{"source":"node_modules/ipfs/src/core/runtime/dns-browser.js","name":"json","original":{"line":28,"column":25},"generated":{"line":1,"column":309}},{"source":"node_modules/ipfs/src/core/runtime/dns-browser.js","original":{"line":13,"column":12},"generated":{"line":1,"column":311}},{"source":"node_modules/ipfs/src/core/runtime/dns-browser.js","name":"ipfsPath","original":{"line":34,"column":6},"generated":{"line":1,"column":321}},{"source":"node_modules/ipfs/src/core/runtime/dns-browser.js","name":"response","original":{"line":34,"column":18},"generated":{"line":1,"column":323}},{"source":"node_modules/ipfs/src/core/runtime/dns-browser.js","name":"response","original":{"line":35,"column":6},"generated":{"line":1,"column":327}},{"source":"node_modules/ipfs/src/core/runtime/dns-browser.js","name":"response","original":{"line":35,"column":6},"generated":{"line":1,"column":330}},{"source":"node_modules/ipfs/src/core/runtime/dns-browser.js","name":"Path","original":{"line":35,"column":15},"generated":{"line":1,"column":332}},{"source":"node_modules/ipfs/src/core/runtime/dns-browser.js","original":{"line":35,"column":21},"generated":{"line":1,"column":337}},{"source":"node_modules/ipfs/src/core/runtime/dns-browser.js","name":"response","original":{"line":35,"column":28},"generated":{"line":1,"column":344}},{"source":"node_modules/ipfs/src/core/runtime/dns-browser.js","name":"Path","original":{"line":35,"column":37},"generated":{"line":1,"column":346}},{"source":"node_modules/ipfs/src/core/runtime/dns-browser.js","original":{"line":36,"column":8},"generated":{"line":1,"column":351}},{"source":"node_modules/ipfs/src/core/runtime/dns-browser.js","original":{"line":36,"column":8},"generated":{"line":1,"column":357}},{"source":"node_modules/ipfs/src/core/runtime/dns-browser.js","name":"Error","original":{"line":36,"column":12},"generated":{"line":1,"column":361}},{"source":"node_modules/ipfs/src/core/runtime/dns-browser.js","name":"response","original":{"line":36,"column":18},"generated":{"line":1,"column":367}},{"source":"node_modules/ipfs/src/core/runtime/dns-browser.js","name":"Message","original":{"line":36,"column":27},"generated":{"line":1,"column":369}},{"source":"node_modules/ipfs/src/core/runtime/dns-browser.js","name":"module","original":{"line":39,"column":0},"generated":{"line":1,"column":379}},{"source":"node_modules/ipfs/src/core/runtime/dns-browser.js","name":"exports","original":{"line":39,"column":7},"generated":{"line":1,"column":386}},{"source":"node_modules/ipfs/src/core/runtime/dns-browser.js","original":{"line":39,"column":17},"generated":{"line":1,"column":394}},{"source":"node_modules/ipfs/src/core/runtime/dns-browser.js","name":"fqdn","original":{"line":39,"column":24},"generated":{"line":1,"column":401}},{"source":"node_modules/ipfs/src/core/runtime/dns-browser.js","name":"opts","original":{"line":39,"column":30},"generated":{"line":1,"column":403}},{"source":"node_modules/ipfs/src/core/runtime/dns-browser.js","name":"resolveDnslink","original":{"line":58,"column":9},"generated":{"line":1,"column":408}},{"source":"node_modules/ipfs/src/core/runtime/dns-browser.js","original":{"line":40,"column":25},"generated":{"line":1,"column":414}},{"source":"node_modules/ipfs/src/core/runtime/dns-browser.js","name":"fqdn","original":{"line":40,"column":32},"generated":{"line":1,"column":421}},{"source":"node_modules/ipfs/src/core/runtime/dns-browser.js","name":"opts","original":{"line":40,"column":38},"generated":{"line":1,"column":423}},{"source":"node_modules/ipfs/src/core/runtime/dns-browser.js","name":"opts","original":{"line":41,"column":4},"generated":{"line":1,"column":428}},{"source":"node_modules/ipfs/src/core/runtime/dns-browser.js","name":"opts","original":{"line":41,"column":11},"generated":{"line":1,"column":430}},{"source":"node_modules/ipfs/src/core/runtime/dns-browser.js","original":{"line":41,"column":19},"generated":{"line":1,"column":433}},{"source":"node_modules/ipfs/src/core/runtime/dns-browser.js","name":"searchParams","original":{"line":43,"column":10},"generated":{"line":1,"column":436}},{"source":"node_modules/ipfs/src/core/runtime/dns-browser.js","name":"searchParams","original":{"line":43,"column":10},"generated":{"line":1,"column":442}},{"source":"node_modules/ipfs/src/core/runtime/dns-browser.js","original":{"line":43,"column":25},"generated":{"line":1,"column":444}},{"source":"node_modules/ipfs/src/core/runtime/dns-browser.js","name":"URLSearchParams","original":{"line":43,"column":29},"generated":{"line":1,"column":448}},{"source":"node_modules/ipfs/src/core/runtime/dns-browser.js","name":"opts","original":{"line":43,"column":45},"generated":{"line":1,"column":464}},{"source":"node_modules/ipfs/src/core/runtime/dns-browser.js","name":"searchParams","original":{"line":44,"column":4},"generated":{"line":1,"column":467}},{"source":"node_modules/ipfs/src/core/runtime/dns-browser.js","name":"set","original":{"line":44,"column":17},"generated":{"line":1,"column":469}},{"source":"node_modules/ipfs/src/core/runtime/dns-browser.js","original":{"line":44,"column":21},"generated":{"line":1,"column":473}},{"source":"node_modules/ipfs/src/core/runtime/dns-browser.js","name":"fqdn","original":{"line":44,"column":28},"generated":{"line":1,"column":479}},{"source":"node_modules/ipfs/src/core/runtime/dns-browser.js","name":"query","original":{"line":47,"column":10},"generated":{"line":1,"column":482}},{"source":"node_modules/ipfs/src/core/runtime/dns-browser.js","name":"query","original":{"line":47,"column":10},"generated":{"line":1,"column":488}},{"source":"node_modules/ipfs/src/core/runtime/dns-browser.js","name":"searchParams","original":{"line":47,"column":18},"generated":{"line":1,"column":490}},{"source":"node_modules/ipfs/src/core/runtime/dns-browser.js","name":"toString","original":{"line":47,"column":31},"generated":{"line":1,"column":492}},{"source":"node_modules/ipfs/src/core/runtime/dns-browser.js","original":{"line":48,"column":8},"generated":{"line":1,"column":503}},{"source":"node_modules/ipfs/src/core/runtime/dns-browser.js","name":"opts","original":{"line":48,"column":9},"generated":{"line":1,"column":507}},{"source":"node_modules/ipfs/src/core/runtime/dns-browser.js","name":"nocache","original":{"line":48,"column":14},"generated":{"line":1,"column":509}},{"source":"node_modules/ipfs/src/core/runtime/dns-browser.js","name":"cache","original":{"line":48,"column":25},"generated":{"line":1,"column":518}},{"source":"node_modules/ipfs/src/core/runtime/dns-browser.js","name":"has","original":{"line":48,"column":31},"generated":{"line":1,"column":520}},{"source":"node_modules/ipfs/src/core/runtime/dns-browser.js","name":"query","original":{"line":48,"column":35},"generated":{"line":1,"column":524}},{"source":"node_modules/ipfs/src/core/runtime/dns-browser.js","original":{"line":48,"column":43},"generated":{"line":1,"column":527}},{"source":"node_modules/ipfs/src/core/runtime/dns-browser.js","name":"response","original":{"line":49,"column":12},"generated":{"line":1,"column":528}},{"source":"node_modules/ipfs/src/core/runtime/dns-browser.js","name":"response","original":{"line":49,"column":12},"generated":{"line":1,"column":534}},{"source":"node_modules/ipfs/src/core/runtime/dns-browser.js","name":"cache","original":{"line":49,"column":23},"generated":{"line":1,"column":536}},{"source":"node_modules/ipfs/src/core/runtime/dns-browser.js","name":"get","original":{"line":49,"column":29},"generated":{"line":1,"column":538}},{"source":"node_modules/ipfs/src/core/runtime/dns-browser.js","name":"query","original":{"line":49,"column":33},"generated":{"line":1,"column":542}},{"source":"node_modules/ipfs/src/core/runtime/dns-browser.js","name":"ipfsPath","original":{"line":50,"column":13},"generated":{"line":1,"column":545}},{"source":"node_modules/ipfs/src/core/runtime/dns-browser.js","name":"ipfsPath","original":{"line":50,"column":13},"generated":{"line":1,"column":552}},{"source":"node_modules/ipfs/src/core/runtime/dns-browser.js","name":"response","original":{"line":50,"column":22},"generated":{"line":1,"column":554}},{"source":"node_modules/ipfs/src/core/runtime/dns-browser.js","name":"response","original":{"line":54,"column":10},"generated":{"line":1,"column":557}},{"source":"node_modules/ipfs/src/core/runtime/dns-browser.js","name":"response","original":{"line":54,"column":10},"generated":{"line":1,"column":563}},{"source":"node_modules/ipfs/src/core/runtime/dns-browser.js","name":"httpQueue","original":{"line":54,"column":27},"generated":{"line":1,"column":571}},{"source":"node_modules/ipfs/src/core/runtime/dns-browser.js","name":"add","original":{"line":54,"column":37},"generated":{"line":1,"column":573}},{"source":"node_modules/ipfs/src/core/runtime/dns-browser.js","original":{"line":54,"column":41},"generated":{"line":1,"column":577}},{"source":"node_modules/ipfs/src/core/runtime/dns-browser.js","name":"api","original":{"line":54,"column":47},"generated":{"line":1,"column":581}},{"source":"node_modules/ipfs/src/core/runtime/dns-browser.js","name":"get","original":{"line":54,"column":51},"generated":{"line":1,"column":583}},{"source":"node_modules/ipfs/src/core/runtime/dns-browser.js","original":{"line":54,"column":55},"generated":{"line":1,"column":587}},{"source":"node_modules/ipfs/src/core/runtime/dns-browser.js","original":{"line":54,"column":62},"generated":{"line":1,"column":593}},{"source":"node_modules/ipfs/src/core/runtime/dns-browser.js","name":"searchParams","original":{"line":54,"column":64},"generated":{"line":1,"column":594}},{"source":"node_modules/ipfs/src/core/runtime/dns-browser.js","name":"searchParams","original":{"line":54,"column":64},"generated":{"line":1,"column":607}},{"source":"node_modules/ipfs/src/core/runtime/dns-browser.js","name":"json","original":{"line":54,"column":80},"generated":{"line":1,"column":611}},{"source":"node_modules/ipfs/src/core/runtime/dns-browser.js","name":"ipfsPath","original":{"line":55,"column":11},"generated":{"line":1,"column":619}},{"source":"node_modules/ipfs/src/core/runtime/dns-browser.js","name":"ipfsPath","original":{"line":55,"column":11},"generated":{"line":1,"column":626}},{"source":"node_modules/ipfs/src/core/runtime/dns-browser.js","name":"response","original":{"line":55,"column":20},"generated":{"line":1,"column":628}},{"source":"node_modules/ipfs/src/core/runtime/dns-browser.js","name":"resolveDnslink","original":{"line":58,"column":9},"generated":{"line":1,"column":632}},{"source":"node_modules/ipfs/src/core/runtime/dns-browser.js","name":"fqdn","original":{"line":58,"column":24},"generated":{"line":1,"column":633}},{"source":"node_modules/ipfs/src/core/runtime/dns-browser.js","name":"opts","original":{"line":58,"column":30},"generated":{"line":1,"column":635}}],"sources":{"node_modules/ipfs/src/core/runtime/dns-browser.js":"/* eslint-env browser */\n'use strict'\n\nconst TLRU = require('../../utils/tlru')\nconst { default: PQueue } = require('p-queue')\nconst { default: ky } = require('ky-universal')\n\n// Avoid sending multiple queries for the same hostname by caching results\nconst cache = new TLRU(1000)\n// TODO: /api/v0/dns does not return TTL yet: https://github.com/ipfs/go-ipfs/issues/5884\n// However we know browsers themselves cache DNS records for at least 1 minute,\n// which acts a provisional default ttl: https://stackoverflow.com/a/36917902/11518426\nconst ttl = 60 * 1000\n\n// browsers limit concurrent connections per host,\n// we don't want preload calls to exhaust the limit (~6)\nconst httpQueue = new PQueue({ concurrency: 4 })\n\n// Delegated HTTP resolver sending DNSLink queries to ipfs.io\n// TODO: replace hardcoded host with configurable DNS over HTTPS: https://github.com/ipfs/js-ipfs/issues/2212\nconst api = ky.create({\n  prefixUrl: 'https://ipfs.io/api/v0/',\n  hooks: {\n    afterResponse: [\n      async (input, options, response) => {\n        const query = new URL(response.url).search.slice(1)\n        const json = await response.json()\n        cache.set(query, json, ttl)\n      }\n    ]\n  }\n})\n\nconst ipfsPath = (response) => {\n  if (response.Path) return response.Path\n  throw new Error(response.Message)\n}\n\nmodule.exports = async (fqdn, opts) => { // eslint-disable-line require-await\n  const resolveDnslink = async (fqdn, opts) => {\n    opts = opts || {}\n\n    const searchParams = new URLSearchParams(opts)\n    searchParams.set('arg', fqdn)\n\n    // try cache first\n    const query = searchParams.toString()\n    if (!opts.nocache && cache.has(query)) {\n      const response = cache.get(query)\n      return ipfsPath(response)\n    }\n\n    // fallback to delegated DNS resolver\n    const response = await httpQueue.add(() => api.get('dns', { searchParams }).json())\n    return ipfsPath(response)\n  }\n\n  return resolveDnslink(fqdn, opts)\n}\n"},"lineCount":null}},"error":null,"hash":"00a2dc655d64be6bbf0c67c9e234a87e","cacheData":{"env":{}}}